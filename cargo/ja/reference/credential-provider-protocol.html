<!DOCTYPE HTML>
<html lang="ja" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Credential Provider Protocol - The Cargo Book</title>


        <!-- Custom HTML head -->
        <style>
            dd {
                margin-bottom: 1em;
            }
        </style>
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/cargo";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/reference/credential-provider-protocol.md`;
                    } else {
                        canonical_href = `${base}/${lang}/reference/credential-provider-protocol.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ja");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ja"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cargo Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/cargo/edit/master/src/doc/src/reference/credential-provider-protocol.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="credential-provider-protocol"><a class="header" href="#credential-provider-protocol">Credential Provider Protocol</a></h1>
<p>This document describes information for building a Cargo credential provider. For information on setting up or using a credential provider, see <a href="registry-authentication.html">Registry Authentication</a>.</p>
<p>When using an external credential provider, Cargo communicates with the credential provider using stdin/stdout messages passed as single lines of JSON.</p>
<p>Cargo will always execute the credential provider with the <code>--cargo-plugin</code> argument. This enables a credential provider executable to have additional functionality beyond what Cargo needs. Additional arguments are included in the JSON via the <code>args</code> field.</p>
<h2 id="json-messages"><a class="header" href="#json-messages">JSON messages</a></h2>
<p>The JSON messages in this document have newlines added for readability. Actual messages must not contain newlines.</p>
<h3 id="credential-hello"><a class="header" href="#credential-hello">Credential hello</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: used to identify the supported protocols on process startup</li>
</ul>
<pre><code class="language-javascript">{
    "v":[1]
}
</code></pre>
<p>Requests sent by Cargo will include a <code>v</code> field set to one of the versions listed here. If Cargo does not support any of the versions offered by the credential provider, it will issue an error and shut down the credential process.</p>
<h3 id="registry-information"><a class="header" href="#registry-information">Registry information</a></h3>
<ul>
<li>Sent by: Cargo Not a message by itself. Included in all messages sent by Cargo as the <code>registry</code> field.</li>
</ul>
<pre><code class="language-javascript">{
    // Index URL of the registry
    "index-url":"https://github.com/rust-lang/crates.io-index",
    // Name of the registry in configuration (optional)
    "name": "crates-io",
    // HTTP headers received from attempting to access an authenticated registry (optional)
    "headers": ["WWW-Authenticate: cargo"]
}
</code></pre>
<h3 id="login-request"><a class="header" href="#login-request">Login request</a></h3>
<ul>
<li>Sent by: Cargo</li>
<li>Purpose: collect and store credentials</li>
</ul>
<pre><code class="language-javascript">{
    // Protocol version
    "v":1,
    // Action to perform: login
    "kind":"login",
    // Registry information (see Registry information)
    "registry":{"index-url":"sparse+https://registry-url/index/", "name": "my-registry"},
    // User-specified token from stdin or command line (optional)
    "token": "&lt;the token value&gt;",
    // URL that the user could visit to get a token (optional)
    "login-url": "http://registry-url/login",
    // Additional command-line args (optional)
    "args":[]
}
</code></pre>
<p>If the <code>token</code> field is set, then the credential provider should use the token provided. If the <code>token</code> is not set, then the credential provider should prompt the user for a token.</p>
<p>In addition to the arguments that may be passed to the credential provider in configuration, <code>cargo login</code> also supports passing additional command line args via <code>cargo login -- &lt;additional args&gt;</code>. These additional arguments will be included in the <code>args</code> field after any args from Cargo configuration.</p>
<h3 id="read-request"><a class="header" href="#read-request">Read request</a></h3>
<ul>
<li>Sent by: Cargo</li>
<li>Purpose: Get the credential for reading crate information</li>
</ul>
<pre><code class="language-javascript">{
    // Protocol version
    "v":1,
    // Request kind: get credentials
    "kind":"get",
    // Action to perform: read crate information
    "operation":"read",
    // Registry information (see Registry information)
    "registry":{"index-url":"sparse+https://registry-url/index/", "name": "my-registry"},
    // Additional command-line args (optional)
    "args":[]
}
</code></pre>
<h3 id="publish-request"><a class="header" href="#publish-request">Publish request</a></h3>
<ul>
<li>Sent by: Cargo</li>
<li>Purpose: Get the credential for publishing a crate</li>
</ul>
<pre><code class="language-javascript">{
    // Protocol version
    "v":1,
    // Request kind: get credentials
    "kind":"get",
    // Action to perform: publish crate
    "operation":"publish",
    // Crate name
    "name":"sample",
    // Crate version
    "vers":"0.1.0",
    // Crate checksum
    "cksum":"...",
    // Registry information (see Registry information)
    "registry":{"index-url":"sparse+https://registry-url/index/", "name": "my-registry"},
    // Additional command-line args (optional)
    "args":[]
}
</code></pre>
<h3 id="get-success-response"><a class="header" href="#get-success-response">Get success response</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Gives the credential to Cargo</li>
</ul>
<pre><code class="language-javascript">{"Ok":{
    // Response kind: this was a get request
    "kind":"get",
    // Token to send to the registry
    "token":"...",
    // Cache control. Can be one of the following:
    // * "never": do not cache
    // * "session": cache for the current cargo session
    // * "expires": cache for the current cargo session until expiration
    "cache":"expires",
    // Unix timestamp (only for "cache": "expires")
    "expiration":1693942857,
    // Is the token operation independent?
    "operation_independent":true
}}
</code></pre>
<p>The <code>token</code> will be sent to the registry as the value of the <code>Authorization</code> HTTP header.</p>
<p><code>operation_independent</code> indicates whether the token can be cached across different operations (such as publishing or fetching). In general, this should be <code>true</code> unless the provider wants to generate tokens that are scoped to specific operations.</p>
<h3 id="login-success-response"><a class="header" href="#login-success-response">Login success response</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Indicates the login was successful</li>
</ul>
<pre><code class="language-javascript">{"Ok":{
    // Response kind: this was a login request
    "kind":"login"
}}
</code></pre>
<h3 id="logout-success-response"><a class="header" href="#logout-success-response">Logout success response</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Indicates the logout was successful</li>
</ul>
<pre><code class="language-javascript">{"Ok":{
    // Response kind: this was a logout request
    "kind":"logout"
}}
</code></pre>
<h3 id="failure-response-url-not-supported"><a class="header" href="#failure-response-url-not-supported">Failure response (URL not supported)</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Gives error information to Cargo</li>
</ul>
<pre><code class="language-javascript">{"Err":{
    "kind":"url-not-supported"
}}
</code></pre>
<p>Sent if the credential provider is designed to only handle specific registry URLs and the given URL is not supported. Cargo will attempt another provider if available.</p>
<h3 id="failure-response-not-found"><a class="header" href="#failure-response-not-found">Failure response (not found)</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Gives error information to Cargo</li>
</ul>
<pre><code class="language-javascript">{"Err":{
    // Error: The credential could not be found in the provider.
    "kind":"not-found"
}}
</code></pre>
<p>Sent if the credential could not be found. This is expected for <code>get</code> requests where the credential is not available, or <code>logout</code> requests where there is nothing found to erase.</p>
<h3 id="failure-response-operation-not-supported"><a class="header" href="#failure-response-operation-not-supported">Failure response (operation not supported)</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Gives error information to Cargo</li>
</ul>
<pre><code class="language-javascript">{"Err":{
    // Error: The credential could not be found in the provider.
    "kind":"operation-not-supported"
}}
</code></pre>
<p>Sent if the credential provider does not support the requested operation. If a provider only supports <code>get</code> and a <code>login</code> is requested, the provider should respond with this error.</p>
<h3 id="failure-response-other"><a class="header" href="#failure-response-other">Failure response (other)</a></h3>
<ul>
<li>Sent by: credential provider</li>
<li>Purpose: Gives error information to Cargo</li>
</ul>
<pre><code class="language-javascript">{"Err":{
    // Error: something else has failed
    "kind":"other",
    // Error message string to be displayed
    "message": "free form string error message",
    // Detailed cause chain for the error (optional)
    "caused-by": ["cause 1", "cause 2"]
}}
</code></pre>
<h2 id="example-communication-to-request-a-token-for-reading"><a class="header" href="#example-communication-to-request-a-token-for-reading">Example communication to request a token for reading:</a></h2>
<ol>
<li>
<p>Cargo spawns the credential process, capturing stdin and stdout.</p>
</li>
<li>
<p>Credential process sends the Hello message to Cargo</p>
<pre><code class="language-javascript">{ "v": [1] }
</code></pre>
</li>
<li>
<p>Cargo sends the CredentialRequest message to the credential process (newlines added for readability).</p>
<pre><code class="language-javascript">{
    "v": 1,
    "kind": "get",
    "operation": "read",
    "registry":{"index-url":"sparse+https://registry-url/index/"}
}
</code></pre>
</li>
<li>
<p>Credential process sends the CredentialResponse to Cargo (newlines added for readability).</p>
<pre><code class="language-javascript">{
    "token": "...",
    "cache": "session",
    "operation_independent": true
}
</code></pre>
</li>
<li>
<p>Cargo closes the stdin pipe to the credential provider and it exits.</p>
</li>
<li>
<p>Cargo uses the token for the remainder of the session (until Cargo exits) when interacting with this registry.</p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/registry-authentication.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../reference/running-a-registry.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/registry-authentication.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../reference/running-a-registry.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/language-picker.js"></script>


    </div>
    </body>
</html>
