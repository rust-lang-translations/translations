<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>안전한 코드와 안전하지 않은 코드는 어떻게 상호작용하는가 - The Rustonomicon</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/nomicon";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/safe-unsafe-meaning.md`;
                    } else {
                        canonical_href = `${base}/${lang}/safe-unsafe-meaning.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ko");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="The Dark Arts of Advanced and Unsafe Rust Programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/nomicon.css">
        <link rel="stylesheet" href="theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rustonomicon</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="안전한-코드와-안전하지-않은-코드는-어떻게-상호작용하는가"><a class="header" href="#안전한-코드와-안전하지-않은-코드는-어떻게-상호작용하는가">안전한 코드와 안전하지 않은 코드는 어떻게 상호작용하는가</a></h1>
<p>안전한 러스트와 안전하지 않은 러스트의 관계는 무엇일까요? 이들은 어떻게 상호 작용할까요?</p>
<p>안전한 러스트와 안전하지 않은 러스트의 분리는 <code>unsafe</code> 키워드로 제어되며, 이는 둘 사이의 인터페이스 역할을 합니다. 이것이 안전한 러스트가 안전한 언어라고 말할 수 있는 이유입니다. 모든 안전하지 않은 부분은 <code>unsafe</code> 경계 뒤에만 존재합니다. 원한다면 <code>#[forbid(unsafe_code)]</code>를 코드베이스에 넣어 안전한 러스트만 작성하고 있음을 정적으로 보장할 수도 있습니다. 이는 임베디드 러스트에서 흔히 사용되는 관행으로, 전체 애플리케이션은 종종 안전한 러스트로 작성되고, <code>unsafe</code> 코드는 작은 HAL(하드웨어 추상화 계층) 크레이트에 국한됩니다.</p>
<p><code>unsafe</code> 키워드는 두 가지 용도로 사용됩니다. 컴파일러가 확인할 수 없는 계약의 존재를 선언하고, 프로그래머가 이러한 계약이 준수되었음을 확인했음을 선언하는 것입니다.</p>
<p>You can use <code>unsafe</code> to indicate the existence of unchecked contracts on <em>functions</em> and <em>trait declarations</em>. On functions, <code>unsafe</code> means that users of the function must check that function's documentation to ensure they are using it in a way that maintains the contracts the function requires. On trait declarations, <code>unsafe</code> means that implementors of the trait must check the trait documentation to ensure their implementation maintains the contracts the trait requires.</p>
<p>블록에 <code>unsafe</code>를 사용하여 그 안에서 수행되는 모든 안전하지 않은 작업이 해당 작업의 계약을 준수하는지 확인되었음을 선언할 수 있습니다. 예를 들어, <a href="../std/primitive.slice.html#method.get_unchecked"><code>slice::get_unchecked</code></a>에 전달된 인덱스가 범위 내에 있습니다.</p>
<p>트레잇 구현에 <code>unsafe</code>를 사용하여 해당 구현이 트레잇의 계약을 준수함을 선언할 수 있습니다. 예를 들어, <a href="../std/marker/trait.Send.html"><code>Send</code></a>를 구현하는 타입이 실제로 다른 스레드로 이동해도 안전하다는 것을 선언할 수 있습니다.</p>
<p>표준 라이브러리에는 다음을 포함한 여러 안전하지 않은 함수가 있습니다:</p>
<ul>
<li><a href="../std/primitive.slice.html#method.get_unchecked"><code>slice::get_unchecked</code></a>`는 검사되지 않은 인덱싱을 수행하여 메모리 안전성을 자유롭게 위반할 수 있습니다.</li>
<li><a href="../std/mem/fn.transmute.html"><code>mem::transmute</code></a> reinterprets some value as having a given type, bypassing type safety in arbitrary ways (see <a href="conversions.html">conversions</a> for details).</li>
<li>크기가 지정된 타입에 대한 모든 원시 포인터는 전달된 오프셋이 <a href="../std/primitive.pointer.html#method.offset">"범위 내"</a>에 있지 않으면 정의되지 않은 동작을 호출하는 <a href="../std/primitive.pointer.html#method.offset"><code>offset</code></a> 메서드를 가집니다.</li>
<li>모든 FFI(외부 함수 인터페이스) 함수는 다른 언어가 러스트 컴파일러가 확인할 수 없는 임의의 작업을 수행할 수 있기 때문에 <code>unsafe</code>로 호출해야 합니다.</li>
</ul>
<p>As of Rust 1.29.2, the standard library defines the following unsafe traits (there are others, but they are not stabilized yet and some of them may never be):</p>
<ul>
<li><a href="../std/marker/trait.Send.html"><code>Send</code></a>`는 구현체가 다른 스레드로 안전하게 전송(이동)될 수 있음을 약속하는 마커 트레잇(API가 없는 트레잇)입니다.</li>
<li><a href="../std/marker/trait.Sync.html"><code>Sync</code></a>`는 구현체가 스레드 간에 참조를 안전하게 공유할 수 있음을 약속하는 마커 트레잇(API가 없는 트레잇)입니다.</li>
<li><a href="../std/alloc/trait.GlobalAlloc.html"><code>GlobalAlloc</code></a> allows customizing the memory allocator of the whole program.</li>
</ul>
<p>러스트 표준 라이브러리의 많은 부분도 내부적으로 안전하지 않은 러스트를 사용합니다. 이러한 구현은 일반적으로 엄격하게 수동으로 검사되었으므로, 이러한 구현 위에 구축된 안전한 러스트 인터페이스는 안전하다고 가정할 수 있습니다.</p>
<p>The need for all of this separation boils down to a single fundamental property of Safe Rust, the <em>soundness property</em>:</p>
<p><strong>어떤 경우에도 안전한 러스트는 정의되지 않은 동작을 유발할 수 없습니다.</strong></p>
<p>안전/비안전 분리의 설계는 안전한 러스트와 안전하지 않은 러스트 사이에 비대칭적인 신뢰 관계가 있음을 의미합니다. 안전한 러스트는 자신이 접하는 모든 안전하지 않은 러스트가 올바르게 작성되었다고 본질적으로 신뢰해야 합니다. 반면에 안전하지 않은 러스트는 주의 없이는 안전한 러스트를 신뢰할 수 없습니다.</p>
<p>예를 들어, 러스트에는 <a href="../std/cmp/trait.PartialOrd.html"><code>PartialOrd</code></a> 및 <a href="../std/cmp/trait.Ord.html"><code>Ord</code></a> 트레잇이 있어 단순히 비교할 수 있는 타입과 "전체" 순서(기본적으로 비교가 합리적으로 작동함을 의미)를 제공하는 타입을 구분합니다.</p>
<p><a href="../std/collections/struct.BTreeMap.html"><code>BTreeMap</code></a><code>은 부분적으로 정렬된 타입에는 적합하지 않으므로, 키가 </code>Ord<code>를 구현하도록 요구합니다. 그러나 </code>BTreeMap<code>은 구현 내부에 안전하지 않은 러스트 코드를 가지고 있습니다. 허술한 </code>Ord<code>구현(안전하게 작성할 수 있음)이 정의되지 않은 동작을 유발하는 것은 용납할 수 없으므로,</code>BTreeMap<code>의 안전하지 않은 코드는 </code>Ord<code>를 요구하는 전체적인 목적에도 불구하고 실제로는 완전하지 않은 </code>Ord` 구현에 대해 견고하도록 작성되어야 합니다.</p>
<p>안전하지 않은 러스트 코드는 안전한 러스트 코드가 올바르게 작성되었다고 신뢰할 수 없습니다. 그렇다고 해도, <code>BTreeMap</code>은 전체 순서가 없는 값을 입력하면 여전히 완전히 불규칙하게 작동할 것입니다. 단지 정의되지 않은 동작을 유발하지는 않을 것입니다.</p>
<p><code>BTreeMap</code>이 <code>Ord</code>가 안전하다는 이유로 신뢰할 수 없다면, 왜 <em>어떤</em> 안전한 코드도 신뢰할 수 있는지 궁금할 수 있습니다. 예를 들어 <code>BTreeMap</code>은 정수와 슬라이스가 올바르게 구현되었다고 가정합니다. 그것들도 안전하겠죠?</p>
<p>차이점은 범위에 있습니다. <code>BTreeMap</code>이 정수와 슬라이스에 의존할 때, 이는 매우 특정한 구현에 의존하는 것입니다. 이는 이점에 대비하여 측정할 수 있는 위험입니다. 이 경우 위험은 기본적으로 0입니다. 정수와 슬라이스가 고장 나면 _모든 사람_이 고장 납니다. 또한, <code>BTreeMap</code>을 유지 관리하는 동일한 사람들이 유지 관리하므로, 이들을 쉽게 추적할 수 있습니다.</p>
<p>On the other hand, <code>BTreeMap</code>'s key type is generic. Trusting its <code>Ord</code> implementation means trusting every <code>Ord</code> implementation in the past, present, and future. Here the risk is high: someone somewhere is going to make a mistake and mess up their <code>Ord</code> implementation, or even just straight up lie about providing a total ordering because "it seems to work". When that happens, <code>BTreeMap</code> needs to be prepared.</p>
<p>동일한 논리가 올바르게 작동하도록 전달된 클로저를 신뢰하는 데에도 적용됩니다.</p>
<p>이러한 무한한 일반 신뢰 문제는 <code>unsafe</code> 트레잇이 해결하기 위해 존재하는 문제입니다. <code>BTreeMap</code> 타입은 이론적으로 <code>Ord</code> 대신 <code>UnsafeOrd</code>라는 새로운 트레잇을 키가 구현하도록 요구할 수 있으며, 이는 다음과 같을 수 있습니다:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::cmp::Ordering;

unsafe trait UnsafeOrd {
    fn cmp(&amp;self, other: &amp;Self) -&gt; Ordering;
}
<span class="boring">}</span></code></pre></pre>
<p>그러면 타입은 <code>unsafe</code>를 사용하여 <code>UnsafeOrd</code>를 구현하고, 해당 구현이 트레잇이 기대하는 모든 계약을 유지함을 보장했음을 나타냅니다. 이 상황에서 <code>BTreeMap</code> 내부의 안전하지 않은 러스트는 키 타입의 <code>UnsafeOrd</code> 구현이 올바르다고 신뢰하는 것이 정당화될 것입니다. 만약 그렇지 않다면, 이는 안전하지 않은 트레잇 구현의 잘못이며, 이는 러스트의 안전 보장과 일치합니다.</p>
<p>트레잇을 <code>unsafe</code>로 표시할지 여부는 API 설계 선택입니다. 안전한 트레잇은 구현하기 쉽지만, 이에 의존하는 모든 안전하지 않은 코드는 잘못된 동작에 대해 방어해야 합니다. 트레잇을 <code>unsafe</code>로 표시하면 이 책임이 구현자에게 전가됩니다. 러스트는 전통적으로 트레잇을 <code>unsafe</code>로 표시하는 것을 피했는데, 이는 안전하지 않은 러스트를 만연하게 만들어 바람직하지 않기 때문입니다.</p>
<p><code>Send</code> and <code>Sync</code> are marked unsafe because thread safety is a <em>fundamental property</em> that unsafe code can't possibly hope to defend against in the way it could defend against a buggy <code>Ord</code> implementation. Similarly, <code>GlobalAlloc</code> is keeping accounts of all the memory in the program and other things like <code>Box</code> or <code>Vec</code> that build on top of it. If it does something weird (giving the same chunk of memory to another request when it is still in use), there's no chance to detect that and do anything about it.</p>
<p>자신만의 트레잇을 <code>unsafe</code>로 표시할지 여부는 동일한 종류의 고려 사항에 따라 달라집니다. <code>unsafe</code> 코드가 트레잇의 깨진 구현에 대해 합리적으로 방어할 수 없다면, 트레잇을 <code>unsafe</code>로 표시하는 것이 합리적인 선택입니다.</p>
<p>As an aside, while <code>Send</code> and <code>Sync</code> are <code>unsafe</code> traits, they are <em>also</em> automatically implemented for types when such derivations are provably safe to do. <code>Send</code> is automatically derived for all types composed only of values whose types also implement <code>Send</code>. <code>Sync</code> is automatically derived for all types composed only of values whose types also implement <code>Sync</code>. This minimizes the pervasive unsafety of making these two traits <code>unsafe</code>. And not many people are going to <em>implement</em> memory allocators (or use them directly, for that matter).</p>
<p>이것이 안전한 러스트와 안전하지 않은 러스트 사이의 균형입니다. 분리는 안전한 러스트를 가능한 한 인체공학적으로 사용하도록 설계되었지만, 안전하지 않은 러스트를 작성할 때는 추가적인 노력과 주의가 필요합니다. 이 책의 나머지 부분은 주로 취해야 할 주의 사항과 안전하지 않은 러스트가 준수해야 하는 계약에 대한 논의입니다.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="meet-safe-and-unsafe.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="what-unsafe-does.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="meet-safe-and-unsafe.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="what-unsafe-does.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/language-picker.js"></script>


    </div>
    </body>
</html>
