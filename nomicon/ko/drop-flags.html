<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>드롭 플래그 - The Rustonomicon</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/nomicon";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/drop-flags.md`;
                    } else {
                        canonical_href = `${base}/${lang}/drop-flags.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ko");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="The Dark Arts of Advanced and Unsafe Rust Programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/nomicon.css">
        <link rel="stylesheet" href="theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rustonomicon</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="드롭-플래그"><a class="header" href="#드롭-플래그">드롭 플래그</a></h1>
<p>이전 섹션의 예제들은 러스트에게 흥미로운 과제를 던져줍니다. 우리는 메모리 위치를 조건부로 초기화, 미초기화, 그리고 재초기화하는 것이 완전히 안전하게 가능하다는 것을 보았습니다. <code>Copy</code> 타입의 경우, 그것들은 단지 무작위적인 비트 더미일 뿐이므로 특별히 주목할 만한 점은 없습니다. 하지만 소멸자(destructor)를 가진 타입들의 경우는 이야기가 다릅니다. 러스트는 변수에 값이 할당되거나 변수가 스코프를 벗어날 때마다 소멸자를 호출해야 할지 말아야 할지를 알아야 합니다. 조건부 초기화가 이루어지는 상황에서 어떻게 이를 수행할 수 있을까요?</p>
<p>모든 할당이 이 문제를 걱정해야 하는 것은 아닙니다. 특히 역참조(dereference)를 통한 할당은 무조건 드롭(drop)을 수행하며, <code>let</code>을 통한 할당은 무조건 드롭을 수행하지 않습니다:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = Box::new(0); // let은 새로운 변수를 만드므로, 결코 드롭할 필요가 없습니다
let y = &amp;mut x;
*y = Box::new(1); // 역참조는 지칭 대상이 초기화되었다고 가정하므로, 항상 드롭합니다
<span class="boring">}</span></code></pre></pre>
<p>이는 이전에 초기화된 변수나 그 하위 필드를 덮어쓸 때만 문제가 됩니다.</p>
<p>알고 보니 러스트는 실제로 타입이 드롭되어야 하는지 여부를 <em>런타임에</em> 추적합니다. 변수가 초기화되거나 미초기화됨에 따라, 해당 변수에 대한 _드롭 플래그(drop flag)_가 토글됩니다. 변수가 드롭될 필요가 있을 때, 이 플래그를 확인하여 실제로 드롭을 수행할지 결정합니다.</p>
<p>물론, 값의 초기화 상태가 프로그램의 모든 시점에서 정적으로 알려질 수 있는 경우도 많습니다. 이런 경우 컴파일러는 이론적으로 더 효율적인 코드를 생성할 수 있습니다! 예를 들어, 분기 없는 직선적인 코드는 다음과 같은 _정적 드롭 의미론(static drop semantics)_을 갖습니다:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = Box::new(0); // x는 미초기화 상태였음. 그냥 덮어씀.
let mut y = x;           // y는 미초기화 상태였음. 그냥 덮어쓰고 x를 미초기화 상태로 만듦.
x = Box::new(0);         // x는 미초기화 상태였음. 그냥 덮어씀.
y = x;                   // y는 초기화된 상태였음. y를 드롭하고, 덮어쓰고, x를 미초기화 상태로 만듦!
                         // y가 스코프를 벗어남. y는 초기화된 상태였음. y를 드롭!
                         // x가 스코프를 벗어남. x는 미초기화 상태였음. 아무것도 하지 않음.
<span class="boring">}</span></code></pre></pre>
<p>마찬가지로, 모든 분기가 초기화와 관련하여 동일하게 동작하는 분기 코드도 정적 드롭 의미론을 갖습니다:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let condition = true;
</span>let mut x = Box::new(0);    // x는 미초기화 상태였음. 그냥 덮어씀.
if condition {
    drop(x)                 // x가 이동됨. x를 미초기화 상태로 만듦.
} else {
    println!("{}", x);
    drop(x)                 // x가 이동됨. x를 미초기화 상태로 만듦.
}
x = Box::new(0);            // x는 미초기화 상태였음. 그냥 덮어씀.
                            // x가 스코프를 벗어남. x는 초기화된 상태였음. x를 드롭!
<span class="boring">}</span></code></pre></pre>
<p>하지만 다음과 같은 코드는 올바르게 드롭하기 위해 <em>런타임</em> 정보가 필요합니다:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let condition = true;
</span>let x;
if condition {
    x = Box::new(0);        // x는 미초기화 상태였음. 그냥 덮어씀.
    println!("{}", x);
}
                            // x가 스코프를 벗어남. x는 미초기화 상태일 수 있음.
                            // 플래그를 확인!
<span class="boring">}</span></code></pre></pre>
<p>물론, 이 경우에는 정적 드롭 의미론을 다시 확보하는 것이 매우 쉽습니다:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let condition = true;
</span>if condition {
    let x = Box::new(0);
    println!("{}", x);
}
<span class="boring">}</span></code></pre></pre>
<p>드롭 플래그는 스택에서 추적됩니다. 이전 버전의 러스트에서는 <code>Drop</code>을 구현하는 타입의 숨겨진 필드에 드롭 플래그가 저장되었습니다.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="checked-uninit.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="unchecked-uninit.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="checked-uninit.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="unchecked-uninit.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/language-picker.js"></script>


    </div>
    </body>
</html>
