<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>경쟁 - The Rustonomicon</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/nomicon";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/races.md`;
                    } else {
                        canonical_href = `${base}/${lang}/races.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ko");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="The Dark Arts of Advanced and Unsafe Rust Programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/nomicon.css">
        <link rel="stylesheet" href="theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rustonomicon</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="데이터-경쟁과-경쟁-조건"><a class="header" href="#데이터-경쟁과-경쟁-조건">데이터 경쟁과 경쟁 조건</a></h1>
<p>안전한 러스트는 데이터 경쟁이 없음을 보장하며, 데이터 경쟁은 다음과 같이 정의됩니다:</p>
<ul>
<li>둘 이상의 스레드가 동시에 메모리 위치에 접근함</li>
<li>그중 하나 이상이 쓰기 작업임</li>
<li>그중 하나 이상이 동기화되지 않음</li>
</ul>
<p>데이터 경쟁은 정의되지 않은 동작을 유발하며, 따라서 안전한 러스트에서는 수행할 수 없습니다. 데이터 경쟁은 <em>주로</em> 러스트의 소유권 시스템만으로 방지됩니다. 가변 참조를 별칭(alias)하는 것이 불가능하므로 데이터 경쟁이 일어날 수 없습니다. 내부 가변성은 이를 더 복잡하게 만드는데, 이것이 바로 우리에게 <code>Send</code>와 <code>Sync</code> 트레잇이 있는 주된 이유입니다(자세한 내용은 다음 섹션을 참조하세요).</p>
<p><strong>하지만 러스트는 일반적인 경쟁 조건(race conditions)을 방지하지는 않습니다.</strong></p>
<p>스케줄러를 직접 통제하지 못하는 상황에서는 이를 방지하는 것이 수학적으로 불가능하며, 일반적인 OS 환경이 바로 그러합니다. 만약 선점(preemption)을 제어할 수 있다면 일반적인 경쟁을 방지하는 것이 <em>가능할 수도</em> 있습니다. 이러한 기법은 <a href="https://github.com/rtic-rs/rtic">RTIC</a>과 같은 프레임워크에서 사용됩니다. 하지만 실제로 스케줄링에 대한 제어권을 갖는 경우는 매우 드뭅니다.</p>
<p>이러한 이유로, 러스트에서 교착 상태(deadlock)에 빠지거나 잘못된 동기화로 인해 무의미한 동작을 수행하는 것은 "안전한(safe)" 것으로 간주됩니다. 이는 일반적인 경쟁 조건 또는 자원 경쟁으로 알려져 있습니다. 분명히 그런 프로그램은 좋지 않지만, 러스트가 모든 논리적 에러를 방지할 수는 없습니다.</p>
<p>어떠한 경우에도 경쟁 조건 자체가 러스트 프로그램에서 메모리 안전성을 위반할 수는 없습니다. 오직 다른 비안전한(unsafe) 코드와 결합될 때만 경쟁 조건이 실제로 메모리 안전성을 위반할 수 있습니다. 예를 들어, 올바른 프로그램은 다음과 같습니다:</p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::thread;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::Arc;

let data = vec![1, 2, 3, 4];
// Arc를 사용하여 AtomicUsize가 저장된 메모리가 다른 스레드에 의해 증가될 수 있도록
// 계속 존재하게 합니다. 우리가 그보다 먼저 실행을 완전히 마쳐도 말이죠.
// thread::spawn의 수명 요구 사항 때문에 Arc 없이는 프로그램이 컴파일되지 않습니다!
let idx = Arc::new(AtomicUsize::new(0));
let other_idx = idx.clone();

// `move`는 other_idx를 값으로 캡처하여 이 스레드로 이동시킵니다
thread::spawn(move || {
    // idx를 변경하는 것은 괜찮습니다. 이 값은
    // 아토믹(atomic)이므로 데이터 경쟁을 일으킬 수 없기 때문입니다.
    other_idx.fetch_add(10, Ordering::SeqCst);
});

// 아토믹에서 로드한 값으로 인덱싱합니다. 이는 안전합니다. 아토믹 메모리를
// 단 한 번만 읽고, 그 복사본을 Vec의 인덱싱 구현에 전달하기 때문입니다.
// 이 인덱싱은 올바르게 범위를 체크하며, 중간에 값이 바뀔 염려가 없습니다.
// 하지만 우리가 생성한 스레드가 이 코드가 실행되기 전에 인덱스를 증가시켰다면
// 패닉이 발생할 수 있습니다. 프로그램의 올바른 실행(패닉이 발생하는 것은 대개 올바르지 않음)이
// 스레드 실행 순서에 달려 있으므로, 이는 경쟁 조건(race condition)입니다.
println!("{}", data[idx.load(Ordering::SeqCst)]);
<span class="boring">}</span></code></pre></pre>
<p>만약 우리가 미리 범위 체크를 한 뒤, 체크되지 않은 값으로 데이터를 비안전하게 접근한다면 경쟁 조건이 메모리 안전성을 위반하게 만들 수 있습니다:</p>
<pre><pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::thread;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::Arc;

let data = vec![1, 2, 3, 4];

let idx = Arc::new(AtomicUsize::new(0));
let other_idx = idx.clone();

// `move`는 other_idx를 값으로 캡처하여 이 스레드로 이동시킵니다
thread::spawn(move || {
    // idx를 변경하는 것은 괜찮습니다. 이 값은
    // 아토믹(atomic)이므로 데이터 경쟁을 일으킬 수 없기 때문입니다.
    other_idx.fetch_add(10, Ordering::SeqCst);
});

if idx.load(Ordering::SeqCst) &lt; data.len() {
    unsafe {
        // 범위 체크를 한 뒤에 idx를 잘못 로드하고 있습니다.
        // 값이 변했을 수 있습니다. 이는 경쟁 조건이며, 우리가 `unsafe`한
        // `get_unchecked`를 사용하기로 했기 때문에 *위험*합니다.
        println!("{}", data.get_unchecked(idx.load(Ordering::SeqCst)));
    }
}
<span class="boring">}</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="concurrency.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="send-and-sync.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="concurrency.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="send-and-sync.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/language-picker.js"></script>


    </div>
    </body>
</html>
