<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>비안전과 함께 작업하기 - The Rustonomicon</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/nomicon";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/working-with-unsafe.md`;
                    } else {
                        canonical_href = `${base}/${lang}/working-with-unsafe.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ko");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="The Dark Arts of Advanced and Unsafe Rust Programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/nomicon.css">
        <link rel="stylesheet" href="theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rustonomicon</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="비안전과-함께-작업하기"><a class="header" href="#비안전과-함께-작업하기">비안전과 함께 작업하기</a></h1>
<p>Rust는 일반적으로 범위가 지정되고 이진적인 방식으로 Unsafe Rust에 대해 이야기할 수 있는 도구만 제공합니다. 불행히도 현실은 그보다 훨씬 더 복잡합니다. 예를 들어 다음 장난감 함수를 고려하십시오.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn index(idx: usize, arr: &amp;[u8]) -&gt; Option&lt;u8&gt; {
    if idx &lt; arr.len() {
        unsafe {
            Some(*arr.get_unchecked(idx))
        }
    } else {
        None
    }
}
<span class="boring">}</span></code></pre></pre>
<p>이 함수는 안전하고 정확합니다. 인덱스가 범위 내에 있는지 확인하고, 그렇다면 확인되지 않은 방식으로 배열에 인덱싱합니다. 우리는 이렇게 올바르게 안전하지 않게 구현된 함수를 _건전하다_고 말하며, 이는 안전한 코드가 이를 통해 정의되지 않은 동작을 유발할 수 없음을 의미합니다(기억하세요, 이것이 안전한 Rust의 단일 기본 속성입니다).</p>
<p>그러나 이렇게 사소한 함수에서도 unsafe 블록의 범위는 의심스럽습니다. '&lt;'를 '&lt;='로 변경하는 것을 고려하십시오.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn index(idx: usize, arr: &amp;[u8]) -&gt; Option&lt;u8&gt; {
    if idx &lt;= arr.len() {
        unsafe {
            Some(*arr.get_unchecked(idx))
        }
    } else {
        None
    }
}
<span class="boring">}</span></code></pre></pre>
<p>이 프로그램은 이제 _불건전_하며, 안전한 Rust가 정의되지 않은 동작을 유발할 수 있으며, <em>우리는 안전한 코드만 수정했습니다</em>. 이것이 안전의 근본적인 문제입니다. 즉, 비지역적입니다. 우리의 안전하지 않은 작업의 건전성은 필연적으로 다른 "안전한" 작업에 의해 설정된 상태에 따라 달라집니다.</p>
<p>안전은 비안전을 선택한다고 해서 다른 종류의 임의의 나쁜 점을 고려할 필요가 없다는 의미에서 모듈식입니다. 예를 들어, 슬라이스에 대한 확인되지 않은 인덱싱을 수행한다고 해서 갑자기 슬라이스가 null이거나 초기화되지 않은 메모리를 포함하는 것에 대해 걱정할 필요는 없습니다. 근본적으로 아무것도 바뀌지 않습니다. 그러나 안전은 프로그램이 본질적으로 상태 저장 방식이며 안전하지 않은 작업이 임의의 다른 상태에 따라 달라질 수 있다는 의미에서 모듈식이 <em>아닙니다</em>.</p>
<p>이 비지역성은 실제 영구 상태를 통합할 때 훨씬 더 악화됩니다. 'Vec'의 간단한 구현을 고려하십시오.</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::ptr;

// 참고: 이 정의는 순진합니다. Vec 구현에 대한 장을 참조하십시오.
pub struct Vec&lt;T&gt; {
    ptr: *mut T,
    len: usize,
    cap: usize,
}

// 참고: 이 구현은 크기가 0인 타입을 올바르게 처리하지 않습니다.
// Vec 구현에 대한 장을 참조하십시오.
impl&lt;T&gt; Vec&lt;T&gt; {
    pub fn push(&amp;mut self, elem: T) {
        if self.len == self.cap {
            // 이 예제에서는 중요하지 않음
            self.reallocate();
        }
        unsafe {
            ptr::write(self.ptr.add(self.len), elem);
            self.len += 1;
        }
    }
<span class="boring">    fn reallocate(&amp;mut self) { }
</span>}

<span class="boring">fn main() {}</span></code></pre></pre>
<p>이 코드는 합리적으로 감사하고 비공식적으로 확인할 수 있을 만큼 간단합니다. 이제 다음 메서드를 추가하는 것을 고려하십시오.</p>
<!-- ignore: simplified code -->
<pre><code class="language-rust ignore">fn make_room(&amp;mut self) {
    // 용량 늘리기
    self.cap += 1;
}</code></pre>
<p>이 코드는 100% 안전한 Rust이지만 완전히 불건전합니다. 용량을 변경하면 Vec의 불변성('cap'이 Vec에 할당된 공간을 반영한다는 것)을 위반합니다. 이것은 나머지 Vec이 방어할 수 있는 것이 아닙니다. 확인할 방법이 없기 때문에 용량 필드를 신뢰해야 <em>합니다</em>.</p>
<p>구조체 필드의 불변성에 의존하기 때문에 이 'unsafe' 코드는 전체 함수를 오염시키는 것 이상으로 전체 _모듈_을 오염시킵니다. 일반적으로 unsafe 코드의 범위를 제한하는 유일한 확실한 방법은 개인 정보 보호를 사용하는 모듈 경계입니다.</p>
<p>그러나 이것은 <em>완벽하게</em> 작동합니다. 'make_room'의 존재는 Vec의 건전성에 문제가 되지 않습니다. 왜냐하면 우리가 그것을 공개로 표시하지 않았기 때문입니다. 이 함수를 정의하는 모듈만 호출할 수 있습니다. 또한 'make_room'은 Vec의 개인 필드에 직접 액세스하므로 Vec과 동일한 모듈에서만 작성할 수 있습니다.</p>
<p>따라서 복잡한 불변성에 의존하는 완전히 안전한 추상화를 작성하는 것이 가능합니다. 이것은 안전한 Rust와 안전하지 않은 Rust 간의 관계에 _중요_합니다.</p>
<p>우리는 이미 Unsafe 코드가 <em>일부</em> 안전한 코드를 신뢰해야 하지만 <em>일반적인</em> 안전한 코드를 신뢰해서는 안 된다는 것을 보았습니다. 개인 정보 보호는 비슷한 이유로 unsafe 코드에 중요합니다. 즉, 우주의 모든 안전한 코드가 우리의 신뢰할 수 있는 상태를 망치는 것을 신뢰하지 않아도 되도록 합니다.</p>
<p>안전은 살아있다!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="what-unsafe-does.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="data.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="what-unsafe-does.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="data.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/language-picker.js"></script>


    </div>
    </body>
</html>
