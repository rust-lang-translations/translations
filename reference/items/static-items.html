<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Static items - The Rust Reference</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/reference";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/items/static-items.md`;
                    } else {
                        canonical_href = `${base}/${lang}/items/static-items.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("en");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/reference.css">
        <link rel="stylesheet" href="../theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Reference</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/reference/edit/master/src/items/static-items.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="rule" id="r-items.static"><a class="rule-link" href="#r-items.static" title="items.static"><span>[items<wbr>.static]<span/></a></div>
<h1 id="static-items"><a class="header" href="#static-items">Static items</a></h1>
<div class="rule" id="r-items.static.syntax"><a class="rule-link" href="#r-items.static.syntax" title="items.static.syntax"><span>[items<wbr>.static<wbr>.syntax]<span/></a></div>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>StaticItem</em> :<br />
   <a href="functions.html"><em>ItemSafety</em></a><sup>?</sup><sup class="footnote-reference"><a href="#extern-safety">1</a></sup> <code>static</code> <code>mut</code><sup>?</sup> <a href="../identifiers.html">IDENTIFIER</a> <code>:</code> <a href="../types.html#type-expressions"><em>Type</em></a>
( <code>=</code> <a href="../expressions.html"><em>Expression</em></a> )<sup>?</sup> <code>;</code></p>
<div class="footnote-definition" id="extern-safety"><sup class="footnote-definition-label">1</sup>
<p>The <code>safe</code> and <code>unsafe</code> function qualifiers are only
allowed semantically within <code>extern</code> blocks.</p>
</div>
</blockquote>
<div class="rule" id="r-items.static.intro"><a class="rule-link" href="#r-items.static.intro" title="items.static.intro"><span>[items<wbr>.static<wbr>.intro]<span/></a></div>
<p>A <em>static item</em> is similar to a <a href="constant-items.html">constant</a>, except that it represents an allocated object in the
program that is initialized with the initializer expression. All references and raw pointers to the
static refer to the same allocated object.</p>
<div class="rule" id="r-items.static.lifetime"><a class="rule-link" href="#r-items.static.lifetime" title="items.static.lifetime"><span>[items<wbr>.static<wbr>.lifetime]<span/></a></div>
<p>Static items have the <code>static</code> lifetime, which outlives all other lifetimes in a Rust program.
Static items do not call <a href="../destructors.html"><code>drop</code></a> at the end of the program.</p>
<div class="rule" id="r-items.static.storage-disjointness"><a class="rule-link" href="#r-items.static.storage-disjointness" title="items.static.storage-disjointness"><span>[items<wbr>.static<wbr>.storage-disjointness]<span/></a></div>
<p>If the <code>static</code> has a size of at least 1 byte, this allocated object is disjoint from all other such
<code>static</code> objects as well as heap allocations and stack-allocated variables. However, the storage of
immutable <code>static</code> items can overlap with objects that do not themselves have a unique address, such
as <a href="../destructors.html#constant-promotion">promoteds</a> and <a href="constant-items.html"><code>const</code> items</a>.</p>
<div class="rule" id="r-items.static.namespace"><a class="rule-link" href="#r-items.static.namespace" title="items.static.namespace"><span>[items<wbr>.static<wbr>.namespace]<span/></a></div>
<p>The static declaration defines a static value in the <a href="../names/namespaces.html">value namespace</a> of the module or block where it is located.</p>
<div class="rule" id="r-items.static.init"><a class="rule-link" href="#r-items.static.init" title="items.static.init"><span>[items<wbr>.static<wbr>.init]<span/></a></div>
<p>The static initializer is a <a href="../const_eval.html#constant-expressions">constant expression</a> evaluated at compile time.
Static initializers may refer to and read from other statics.
When reading from mutable statics, they read the initial value of that static.</p>
<div class="rule" id="r-items.static.read-only"><a class="rule-link" href="#r-items.static.read-only" title="items.static.read-only"><span>[items<wbr>.static<wbr>.read-only]<span/></a></div>
<p>Non-<code>mut</code> static items that contain a type that is not <a href="../interior-mutability.html">interior mutable</a> may
be placed in read-only memory.</p>
<div class="rule" id="r-items.static.safety"><a class="rule-link" href="#r-items.static.safety" title="items.static.safety"><span>[items<wbr>.static<wbr>.safety]<span/></a></div>
<p>All access to a static is safe, but there are a number of restrictions on
statics:</p>
<div class="rule" id="r-items.static.sync"><a class="rule-link" href="#r-items.static.sync" title="items.static.sync"><span>[items<wbr>.static<wbr>.sync]<span/></a></div>
<ul>
<li>The type must have the <a href="../../core/marker/trait.Sync.html"><code>Sync</code></a> trait bound to allow thread-safe access.</li>
</ul>
<div class="rule" id="r-items.static.init.omission"><a class="rule-link" href="#r-items.static.init.omission" title="items.static.init.omission"><span>[items<wbr>.static<wbr>.init<wbr>.omission]<span/></a></div>
<p>The initializer expression must be omitted in an <a href="external-blocks.html">external block</a>, and must be
provided for free static items.</p>
<div class="rule" id="r-items.static.safety-qualifiers"><a class="rule-link" href="#r-items.static.safety-qualifiers" title="items.static.safety-qualifiers"><span>[items<wbr>.static<wbr>.safety-qualifiers]<span/></a></div>
<p>The <code>safe</code> and <code>unsafe</code> qualifiers are semantically only allowed when used in an <a href="external-blocks.html">external block</a>.</p>
<div class="rule" id="r-items.static.generics"><a class="rule-link" href="#r-items.static.generics" title="items.static.generics"><span>[items<wbr>.static<wbr>.generics]<span/></a></div>
<h2 id="statics--generics"><a class="header" href="#statics--generics">Statics &amp; generics</a></h2>
<p>A static item defined in a generic scope (for example in a blanket or default
implementation) will result in exactly one static item being defined, as if
the static definition was pulled out of the current scope into the module.
There will <em>not</em> be one item per monomorphization.</p>
<p>This code:</p>
<pre><pre class="playground"><code class="language-rust edition2024">use std::sync::atomic::{AtomicUsize, Ordering};

trait Tr {
    fn default_impl() {
        static COUNTER: AtomicUsize = AtomicUsize::new(0);
        println!("default_impl: counter was {}", COUNTER.fetch_add(1, Ordering::Relaxed));
    }

    fn blanket_impl();
}

struct Ty1 {}
struct Ty2 {}

impl&lt;T&gt; Tr for T {
    fn blanket_impl() {
        static COUNTER: AtomicUsize = AtomicUsize::new(0);
        println!("blanket_impl: counter was {}", COUNTER.fetch_add(1, Ordering::Relaxed));
    }
}

fn main() {
    &lt;Ty1 as Tr&gt;::default_impl();
    &lt;Ty2 as Tr&gt;::default_impl();
    &lt;Ty1 as Tr&gt;::blanket_impl();
    &lt;Ty2 as Tr&gt;::blanket_impl();
}</code></pre></pre>
<p>prints</p>
<pre><code class="language-text">default_impl: counter was 0
default_impl: counter was 1
blanket_impl: counter was 0
blanket_impl: counter was 1
</code></pre>
<div class="rule" id="r-items.static.mut"><a class="rule-link" href="#r-items.static.mut" title="items.static.mut"><span>[items<wbr>.static<wbr>.mut]<span/></a></div>
<h2 id="mutable-statics"><a class="header" href="#mutable-statics">Mutable statics</a></h2>
<div class="rule" id="r-items.static.mut.intro"><a class="rule-link" href="#r-items.static.mut.intro" title="items.static.mut.intro"><span>[items<wbr>.static<wbr>.mut<wbr>.intro]<span/></a></div>
<p>If a static item is declared with the <code>mut</code> keyword, then it is allowed to be
modified by the program. One of Rust’s goals is to make concurrency bugs hard
to run into, and this is obviously a very large source of race conditions or
other bugs</p>
<div class="rule" id="r-items.static.mut.safety"><a class="rule-link" href="#r-items.static.mut.safety" title="items.static.mut.safety"><span>[items<wbr>.static<wbr>.mut<wbr>.safety]<span/></a></div>
<p>For this reason, an <code>unsafe</code> block is required when either reading
or writing a mutable static variable. Care should be taken to ensure that
modifications to a mutable static are safe with respect to other threads
running in the same process.</p>
<div class="rule" id="r-items.static.mut.extern"><a class="rule-link" href="#r-items.static.mut.extern" title="items.static.mut.extern"><span>[items<wbr>.static<wbr>.mut<wbr>.extern]<span/></a></div>
<p>Mutable statics are still very useful, however. They can be used with C
libraries and can also be bound from C libraries in an <code>extern</code> block.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn atomic_add(_: *mut u32, _: u32) -&gt; u32 { 2 }
</span>
static mut LEVELS: u32 = 0;

// This violates the idea of no shared state, and this doesn't internally
// protect against races, so this function is `unsafe`
unsafe fn bump_levels_unsafe() -&gt; u32 {
    unsafe {
        let ret = LEVELS;
        LEVELS += 1;
        return ret;
    }
}

// As an alternative to `bump_levels_unsafe`, this function is safe, assuming
// that we have an atomic_add function which returns the old value. This
// function is safe only if no other code accesses the static in a non-atomic
// fashion. If such accesses are possible (such as in `bump_levels_unsafe`),
// then this would need to be `unsafe` to indicate to the caller that they
// must still guard against concurrent access.
fn bump_levels_safe() -&gt; u32 {
    unsafe {
        return atomic_add(&amp;raw mut LEVELS, 1);
    }
}
<span class="boring">}</span></code></pre></pre>
<div class="rule" id="r-items.static.mut.sync"><a class="rule-link" href="#r-items.static.mut.sync" title="items.static.mut.sync"><span>[items<wbr>.static<wbr>.mut<wbr>.sync]<span/></a></div>
<p>Mutable statics have the same restrictions as normal statics, except that the
type does not have to implement the <code>Sync</code> trait.</p>
<div class="rule" id="r-items.static.alternate"><a class="rule-link" href="#r-items.static.alternate" title="items.static.alternate"><span>[items<wbr>.static<wbr>.alternate]<span/></a></div>
<h2 id="using-statics-or-consts"><a class="header" href="#using-statics-or-consts">Using Statics or Consts</a></h2>
<p>It can be confusing whether or not you should use a constant item or a static
item. Constants should, in general, be preferred over statics unless one of the
following are true:</p>
<ul>
<li>Large amounts of data are being stored.</li>
<li>The single-address property of statics is required.</li>
<li>Interior mutability is required.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../items/constant-items.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../items/traits.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../items/constant-items.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../items/traits.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/reference.js"></script>
        <script src="../theme/language-picker.js"></script>


    </div>
    </body>
</html>
