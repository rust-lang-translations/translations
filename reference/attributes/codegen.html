<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Code generation - The Rust Reference</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/reference";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/attributes/codegen.md`;
                    } else {
                        canonical_href = `${base}/${lang}/attributes/codegen.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("en");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/reference.css">
        <link rel="stylesheet" href="../theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Reference</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/reference/edit/master/src/attributes/codegen.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="rule" id="r-attributes.codegen"><a class="rule-link" href="#r-attributes.codegen" title="attributes.codegen"><span>[attributes<wbr>.codegen]<span/></a></div>
<h1 id="code-generation-attributes"><a class="header" href="#code-generation-attributes">Code generation attributes</a></h1>
<p>The following <a href="../attributes.html">attributes</a> are used for controlling code generation.</p>
<div class="rule" id="r-attributes.codegen.hint"><a class="rule-link" href="#r-attributes.codegen.hint" title="attributes.codegen.hint"><span>[attributes<wbr>.codegen<wbr>.hint]<span/></a></div>
<h2 id="optimization-hints"><a class="header" href="#optimization-hints">Optimization hints</a></h2>
<div class="rule" id="r-attributes.codegen.hint.cold-inline"><a class="rule-link" href="#r-attributes.codegen.hint.cold-inline" title="attributes.codegen.hint.cold-inline"><span>[attributes<wbr>.codegen<wbr>.hint<wbr>.cold-inline]<span/></a></div>
<p>The <code>cold</code> and <code>inline</code> <a href="../attributes.html">attributes</a> give suggestions to generate code in a
way that may be faster than what it would do without the hint. The attributes
are only hints, and may be ignored.</p>
<div class="rule" id="r-attributes.codegen.hint.usage"><a class="rule-link" href="#r-attributes.codegen.hint.usage" title="attributes.codegen.hint.usage"><span>[attributes<wbr>.codegen<wbr>.hint<wbr>.usage]<span/></a></div>
<p>Both attributes can be used on <a href="../items/functions.html">functions</a>. When applied to a function in a
<a href="../items/traits.html">trait</a>, they apply only to that function when used as a default function for
a trait implementation and not to all trait implementations. The attributes
have no effect on a trait function without a body.</p>
<div class="rule" id="r-attributes.codegen.inline"><a class="rule-link" href="#r-attributes.codegen.inline" title="attributes.codegen.inline"><span>[attributes<wbr>.codegen<wbr>.inline]<span/></a></div>
<h3 id="the-inline-attribute"><a class="header" href="#the-inline-attribute">The <code>inline</code> attribute</a></h3>
<div class="rule" id="r-attributes.codegen.inline.intro"><a class="rule-link" href="#r-attributes.codegen.inline.intro" title="attributes.codegen.inline.intro"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.intro]<span/></a></div>
<p>The <em><code>inline</code> <a href="../attributes.html">attribute</a></em> suggests that a copy of the attributed function
should be placed in the caller, rather than generating code to call the
function where it is defined.</p>
<blockquote>
<p><em><strong>Note</strong></em>: The <code>rustc</code> compiler automatically inlines functions based on
internal heuristics. Incorrectly inlining functions can make the program
slower, so this attribute should be used with care.</p>
</blockquote>
<div class="rule" id="r-attributes.codegen.inline.modes"><a class="rule-link" href="#r-attributes.codegen.inline.modes" title="attributes.codegen.inline.modes"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.modes]<span/></a></div>
<p>There are three ways to use the inline attribute:</p>
<ul>
<li><code>#[inline]</code> <em>suggests</em> performing an inline expansion.</li>
<li><code>#[inline(always)]</code> <em>suggests</em> that an inline expansion should always be
performed.</li>
<li><code>#[inline(never)]</code> <em>suggests</em> that an inline expansion should never be
performed.</li>
</ul>
<blockquote>
<p><em><strong>Note</strong></em>: <code>#[inline]</code> in every form is a hint, with no <em>requirements</em>
on the language to place a copy of the attributed function in the caller.</p>
</blockquote>
<div class="rule" id="r-attributes.codegen.cold"><a class="rule-link" href="#r-attributes.codegen.cold" title="attributes.codegen.cold"><span>[attributes<wbr>.codegen<wbr>.cold]<span/></a></div>
<h3 id="the-cold-attribute"><a class="header" href="#the-cold-attribute">The <code>cold</code> attribute</a></h3>
<p>The <em><code>cold</code> <a href="../attributes.html">attribute</a></em> suggests that the attributed function is unlikely to
be called.</p>
<div class="rule" id="r-attributes.codegen.no_builtins"><a class="rule-link" href="#r-attributes.codegen.no_builtins" title="attributes.codegen.no_builtins"><span>[attributes<wbr>.codegen<wbr>.no_builtins]<span/></a></div>
<h2 id="the-no_builtins-attribute"><a class="header" href="#the-no_builtins-attribute">The <code>no_builtins</code> attribute</a></h2>
<p>The <em><code>no_builtins</code> <a href="../attributes.html">attribute</a></em> may be applied at the crate level to disable
optimizing certain code patterns to invocations of library functions that are
assumed to exist.</p>
<div class="rule" id="r-attributes.codegen.target_feature"><a class="rule-link" href="#r-attributes.codegen.target_feature" title="attributes.codegen.target_feature"><span>[attributes<wbr>.codegen<wbr>.target_feature]<span/></a></div>
<h2 id="the-target_feature-attribute"><a class="header" href="#the-target_feature-attribute">The <code>target_feature</code> attribute</a></h2>
<div class="rule" id="r-attributes.codegen.target_feature.intro"><a class="rule-link" href="#r-attributes.codegen.target_feature.intro" title="attributes.codegen.target_feature.intro"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.intro]<span/></a></div>
<p>The <em><code>target_feature</code> <a href="../attributes.html">attribute</a></em> may be applied to a function to
enable code generation of that function for specific platform architecture
features. It uses the <a href="../attributes.html#meta-item-attribute-syntax"><em>MetaListNameValueStr</em></a> syntax with a single key of
<code>enable</code> whose value is a string of comma-separated feature names to enable.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_feature = "avx2")]
</span>#[target_feature(enable = "avx2")]
fn foo_avx2() {}
<span class="boring">}</span></code></pre></pre>
<div class="rule" id="r-attributes.codegen.target_feature.arch"><a class="rule-link" href="#r-attributes.codegen.target_feature.arch" title="attributes.codegen.target_feature.arch"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.arch]<span/></a></div>
<p>Each <a href="../conditional-compilation.html#target_arch">target architecture</a> has a set of features that may be enabled. It is an
error to specify a feature for a target architecture that the crate is not
being compiled for.</p>
<div class="rule" id="r-attributes.codegen.target_feature.closures"><a class="rule-link" href="#r-attributes.codegen.target_feature.closures" title="attributes.codegen.target_feature.closures"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.closures]<span/></a></div>
<p>Closures defined within a <code>target_feature</code>-annotated function inherit the
attribute from the enclosing function.</p>
<div class="rule" id="r-attributes.codegen.target_feature.target-ub"><a class="rule-link" href="#r-attributes.codegen.target_feature.target-ub" title="attributes.codegen.target_feature.target-ub"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.target-ub]<span/></a></div>
<p>It is <a href="../behavior-considered-undefined.html">undefined behavior</a> to call a function that is compiled with a feature
that is not supported on the current platform the code is running on, <em>except</em>
if the platform explicitly documents this to be safe.</p>
<div class="rule" id="r-attributes.codegen.target_feature.safety-restrictions"><a class="rule-link" href="#r-attributes.codegen.target_feature.safety-restrictions" title="attributes.codegen.target_feature.safety-restrictions"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.safety-restrictions]<span/></a></div>
<p>The following restrictions apply unless otherwise specified by the platform rules below:</p>
<ul>
<li>Safe <code>#[target_feature]</code> functions (and closures that inherit the attribute) can only be safely called within a caller that enables all the <code>target_feature</code>s that the callee enables.
This restriction does not apply in an <code>unsafe</code> context.</li>
<li>Safe <code>#[target_feature]</code> functions (and closures that inherit the attribute) can only be coerced to <em>safe</em> function pointers in contexts that enable all the <code>target_feature</code>s that the coercee enables.
This restriction does not apply to <code>unsafe</code> function pointers.</li>
</ul>
<p>Implicitly enabled features are included in this rule. For example an <code>sse2</code> function can call ones marked with <code>sse</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_feature = "sse2")] {
</span>#[target_feature(enable = "sse")]
fn foo_sse() {}

fn bar() {
    // Calling `foo_sse` here is unsafe, as we must ensure that SSE is
    // available first, even if `sse` is enabled by default on the target
    // platform or manually enabled as compiler flags.
    unsafe {
        foo_sse();
    }
}

#[target_feature(enable = "sse")]
fn bar_sse() {
    // Calling `foo_sse` here is safe.
    foo_sse();
    || foo_sse();
}

#[target_feature(enable = "sse2")]
fn bar_sse2() {
    // Calling `foo_sse` here is safe because `sse2` implies `sse`.
    foo_sse();
}
<span class="boring">}
</span><span class="boring">}</span></code></pre></pre>
<div class="rule" id="r-attributes.codegen.target_feature.fn-traits"><a class="rule-link" href="#r-attributes.codegen.target_feature.fn-traits" title="attributes.codegen.target_feature.fn-traits"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.fn-traits]<span/></a></div>
<p>A function with a <code>#[target_feature]</code> attribute <em>never</em> implements the <code>Fn</code> family of traits, although closures inheriting features from the enclosing function do.</p>
<div class="rule" id="r-attributes.codegen.target_feature.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.target_feature.allowed-positions" title="attributes.codegen.target_feature.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.allowed-positions]<span/></a></div>
<p>The <code>#[target_feature]</code> attribute is not allowed on the following places:</p>
<ul>
<li><a href="../crates-and-source-files.html#r-crate.main">the <code>main</code> function</a></li>
<li>a <a href="../runtime.html#r-runtime.panic_handler"><code>panic_handler</code> function</a></li>
<li>safe trait methods</li>
<li>safe default functions in traits</li>
</ul>
<div class="rule" id="r-attributes.codegen.target_feature.inline"><a class="rule-link" href="#r-attributes.codegen.target_feature.inline" title="attributes.codegen.target_feature.inline"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.inline]<span/></a></div>
<p>Functions marked with <code>target_feature</code> are not inlined into a context that
does not support the given features. The <code>#[inline(always)]</code> attribute may not
be used with a <code>target_feature</code> attribute.</p>
<div class="rule" id="r-attributes.codegen.target_feature.availability"><a class="rule-link" href="#r-attributes.codegen.target_feature.availability" title="attributes.codegen.target_feature.availability"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.availability]<span/></a></div>
<h3 id="available-features"><a class="header" href="#available-features">Available features</a></h3>
<p>The following is a list of the available feature names.</p>
<div class="rule" id="r-attributes.codegen.target_feature.x86"><a class="rule-link" href="#r-attributes.codegen.target_feature.x86" title="attributes.codegen.target_feature.x86"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.x86]<span/></a></div>
<h4 id="x86-or-x86_64"><a class="header" href="#x86-or-x86_64"><code>x86</code> or <code>x86_64</code></a></h4>
<p>Executing code with unsupported features is undefined behavior on this platform.
Hence on this platform usage of <code>#[target_feature]</code> functions follows the
<a href="codegen.html#r-attributes.codegen.target_feature.safety-restrictions">above restrictions</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Implicitly Enables</th><th>Description</th></tr></thead><tbody>
<tr><td><code>adx</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Intel_ADX">ADX</a> — Multi-Precision Add-Carry Instruction Extensions</td></tr>
<tr><td><code>aes</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/AES_instruction_set">AES</a> — Advanced Encryption Standard</td></tr>
<tr><td><code>avx</code></td><td><code>sse4.2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions">AVX</a> — Advanced Vector Extensions</td></tr>
<tr><td><code>avx2</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX2">AVX2</a> — Advanced Vector Extensions 2</td></tr>
<tr><td><code>bmi1</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Bit_Manipulation_Instruction_Sets">BMI1</a> — Bit Manipulation Instruction Sets</td></tr>
<tr><td><code>bmi2</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Bit_Manipulation_Instruction_Sets#BMI2">BMI2</a> — Bit Manipulation Instruction Sets 2</td></tr>
<tr><td><code>cmpxchg16b</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/cmpxchg8b:cmpxchg16b"><code>cmpxchg16b</code></a> — Compares and exchange 16 bytes (128 bits) of data atomically</td></tr>
<tr><td><code>f16c</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/F16C">F16C</a> — 16-bit floating point conversion instructions</td></tr>
<tr><td><code>fma</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/FMA_instruction_set">FMA3</a> — Three-operand fused multiply-add</td></tr>
<tr><td><code>fxsr</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/fxsave"><code>fxsave</code></a> and <a href="https://www.felixcloutier.com/x86/fxrstor"><code>fxrstor</code></a> — Save and restore x87 FPU, MMX Technology, and SSE State</td></tr>
<tr><td><code>lzcnt</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/lzcnt"><code>lzcnt</code></a> — Leading zeros count</td></tr>
<tr><td><code>movbe</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/movbe"><code>movbe</code></a> — Move data after swapping bytes</td></tr>
<tr><td><code>pclmulqdq</code></td><td><code>sse2</code></td><td><a href="https://www.felixcloutier.com/x86/pclmulqdq"><code>pclmulqdq</code></a> — Packed carry-less multiplication quadword</td></tr>
<tr><td><code>popcnt</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/popcnt"><code>popcnt</code></a> — Count of bits set to 1</td></tr>
<tr><td><code>rdrand</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/RdRand"><code>rdrand</code></a> — Read random number</td></tr>
<tr><td><code>rdseed</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/RdRand"><code>rdseed</code></a> — Read random seed</td></tr>
<tr><td><code>sha</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/Intel_SHA_extensions">SHA</a> — Secure Hash Algorithm</td></tr>
<tr><td><code>sse</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Streaming_SIMD_Extensions">SSE</a> — Streaming <abbr title="Single Instruction Multiple Data">SIMD</abbr> Extensions</td></tr>
<tr><td><code>sse2</code></td><td><code>sse</code></td><td><a href="https://en.wikipedia.org/wiki/SSE2">SSE2</a> — Streaming SIMD Extensions 2</td></tr>
<tr><td><code>sse3</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/SSE3">SSE3</a> — Streaming SIMD Extensions 3</td></tr>
<tr><td><code>sse4.1</code></td><td><code>ssse3</code></td><td><a href="https://en.wikipedia.org/wiki/SSE4#SSE4.1">SSE4.1</a> — Streaming SIMD Extensions 4.1</td></tr>
<tr><td><code>sse4.2</code></td><td><code>sse4.1</code></td><td><a href="https://en.wikipedia.org/wiki/SSE4#SSE4.2">SSE4.2</a> — Streaming SIMD Extensions 4.2</td></tr>
<tr><td><code>ssse3</code></td><td><code>sse3</code></td><td><a href="https://en.wikipedia.org/wiki/SSSE3">SSSE3</a> — Supplemental Streaming SIMD Extensions 3</td></tr>
<tr><td><code>xsave</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsave"><code>xsave</code></a> — Save processor extended states</td></tr>
<tr><td><code>xsavec</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsavec"><code>xsavec</code></a> — Save processor extended states with compaction</td></tr>
<tr><td><code>xsaveopt</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsaveopt"><code>xsaveopt</code></a> — Save processor extended states optimized</td></tr>
<tr><td><code>xsaves</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsaves"><code>xsaves</code></a> — Save processor extended states supervisor</td></tr>
</tbody></table>
</div><!-- Keep links near each table to make it easier to move and update. -->
<div class="rule" id="r-attributes.codegen.target_feature.aarch64"><a class="rule-link" href="#r-attributes.codegen.target_feature.aarch64" title="attributes.codegen.target_feature.aarch64"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.aarch64]<span/></a></div>
<h4 id="aarch64"><a class="header" href="#aarch64"><code>aarch64</code></a></h4>
<p>On this platform the usage of <code>#[target_feature]</code> functions follows the
<a href="codegen.html#r-attributes.codegen.target_feature.safety-restrictions">above restrictions</a>.</p>
<p>Further documentation on these features can be found in the <a href="https://developer.arm.com/documentation/ddi0487/latest">ARM Architecture
Reference Manual</a>, or elsewhere on <a href="https://developer.arm.com">developer.arm.com</a>.</p>
<blockquote>
<p><em><strong>Note</strong></em>: The following pairs of features should both be marked as enabled
or disabled together if used:</p>
<ul>
<li><code>paca</code> and <code>pacg</code>, which LLVM currently implements as one feature.</li>
</ul>
</blockquote>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Implicitly Enables</th><th>Feature Name</th></tr></thead><tbody>
<tr><td><code>aes</code></td><td><code>neon</code></td><td>FEAT_AES &amp; FEAT_PMULL — Advanced <abbr title="Single Instruction Multiple Data">SIMD</abbr> AES &amp; PMULL instructions</td></tr>
<tr><td><code>bf16</code></td><td></td><td>FEAT_BF16 — BFloat16 instructions</td></tr>
<tr><td><code>bti</code></td><td></td><td>FEAT_BTI — Branch Target Identification</td></tr>
<tr><td><code>crc</code></td><td></td><td>FEAT_CRC — CRC32 checksum instructions</td></tr>
<tr><td><code>dit</code></td><td></td><td>FEAT_DIT — Data Independent Timing instructions</td></tr>
<tr><td><code>dotprod</code></td><td></td><td>FEAT_DotProd — Advanced SIMD Int8 dot product instructions</td></tr>
<tr><td><code>dpb</code></td><td></td><td>FEAT_DPB — Data cache clean to point of persistence</td></tr>
<tr><td><code>dpb2</code></td><td></td><td>FEAT_DPB2 — Data cache clean to point of deep persistence</td></tr>
<tr><td><code>f32mm</code></td><td><code>sve</code></td><td>FEAT_F32MM — SVE single-precision FP matrix multiply instruction</td></tr>
<tr><td><code>f64mm</code></td><td><code>sve</code></td><td>FEAT_F64MM — SVE double-precision FP matrix multiply instruction</td></tr>
<tr><td><code>fcma</code></td><td><code>neon</code></td><td>FEAT_FCMA — Floating point complex number support</td></tr>
<tr><td><code>fhm</code></td><td><code>fp16</code></td><td>FEAT_FHM — Half-precision FP FMLAL instructions</td></tr>
<tr><td><code>flagm</code></td><td></td><td>FEAT_FlagM — Conditional flag manipulation</td></tr>
<tr><td><code>fp16</code></td><td><code>neon</code></td><td>FEAT_FP16 — Half-precision FP data processing</td></tr>
<tr><td><code>frintts</code></td><td></td><td>FEAT_FRINTTS — Floating-point to int helper instructions</td></tr>
<tr><td><code>i8mm</code></td><td></td><td>FEAT_I8MM — Int8 Matrix Multiplication</td></tr>
<tr><td><code>jsconv</code></td><td><code>neon</code></td><td>FEAT_JSCVT — JavaScript conversion instruction</td></tr>
<tr><td><code>lse</code></td><td></td><td>FEAT_LSE — Large System Extension</td></tr>
<tr><td><code>lor</code></td><td></td><td>FEAT_LOR — Limited Ordering Regions extension</td></tr>
<tr><td><code>mte</code></td><td></td><td>FEAT_MTE &amp; FEAT_MTE2 — Memory Tagging Extension</td></tr>
<tr><td><code>neon</code></td><td></td><td>FEAT_FP &amp; FEAT_AdvSIMD — Floating Point and Advanced SIMD extension</td></tr>
<tr><td><code>pan</code></td><td></td><td>FEAT_PAN — Privileged Access-Never extension</td></tr>
<tr><td><code>paca</code></td><td></td><td>FEAT_PAuth — Pointer Authentication (address authentication)</td></tr>
<tr><td><code>pacg</code></td><td></td><td>FEAT_PAuth — Pointer Authentication (generic authentication)</td></tr>
<tr><td><code>pmuv3</code></td><td></td><td>FEAT_PMUv3 — Performance Monitors extension (v3)</td></tr>
<tr><td><code>rand</code></td><td></td><td>FEAT_RNG — Random Number Generator</td></tr>
<tr><td><code>ras</code></td><td></td><td>FEAT_RAS &amp; FEAT_RASv1p1 — Reliability, Availability and Serviceability extension</td></tr>
<tr><td><code>rcpc</code></td><td></td><td>FEAT_LRCPC — Release consistent Processor Consistent</td></tr>
<tr><td><code>rcpc2</code></td><td><code>rcpc</code></td><td>FEAT_LRCPC2 — RcPc with immediate offsets</td></tr>
<tr><td><code>rdm</code></td><td></td><td>FEAT_RDM — Rounding Double Multiply accumulate</td></tr>
<tr><td><code>sb</code></td><td></td><td>FEAT_SB — Speculation Barrier</td></tr>
<tr><td><code>sha2</code></td><td><code>neon</code></td><td>FEAT_SHA1 &amp; FEAT_SHA256 — Advanced SIMD SHA instructions</td></tr>
<tr><td><code>sha3</code></td><td><code>sha2</code></td><td>FEAT_SHA512 &amp; FEAT_SHA3 — Advanced SIMD SHA instructions</td></tr>
<tr><td><code>sm4</code></td><td><code>neon</code></td><td>FEAT_SM3 &amp; FEAT_SM4 — Advanced SIMD SM3/4 instructions</td></tr>
<tr><td><code>spe</code></td><td></td><td>FEAT_SPE — Statistical Profiling Extension</td></tr>
<tr><td><code>ssbs</code></td><td></td><td>FEAT_SSBS &amp; FEAT_SSBS2 — Speculative Store Bypass Safe</td></tr>
<tr><td><code>sve</code></td><td><code>fp16</code></td><td>FEAT_SVE — Scalable Vector Extension</td></tr>
<tr><td><code>sve2</code></td><td><code>sve</code></td><td>FEAT_SVE2 — Scalable Vector Extension 2</td></tr>
<tr><td><code>sve2-aes</code></td><td><code>sve2</code>, <code>aes</code></td><td>FEAT_SVE_AES — SVE AES instructions</td></tr>
<tr><td><code>sve2-sm4</code></td><td><code>sve2</code>, <code>sm4</code></td><td>FEAT_SVE_SM4 — SVE SM4 instructions</td></tr>
<tr><td><code>sve2-sha3</code></td><td><code>sve2</code>, <code>sha3</code></td><td>FEAT_SVE_SHA3 — SVE SHA3 instructions</td></tr>
<tr><td><code>sve2-bitperm</code></td><td><code>sve2</code></td><td>FEAT_SVE_BitPerm — SVE Bit Permute</td></tr>
<tr><td><code>tme</code></td><td></td><td>FEAT_TME — Transactional Memory Extension</td></tr>
<tr><td><code>vh</code></td><td></td><td>FEAT_VHE — Virtualization Host Extensions</td></tr>
</tbody></table>
</div><div class="rule" id="r-attributes.codegen.target_feature.riscv"><a class="rule-link" href="#r-attributes.codegen.target_feature.riscv" title="attributes.codegen.target_feature.riscv"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.riscv]<span/></a></div>
<h4 id="riscv32-or-riscv64"><a class="header" href="#riscv32-or-riscv64"><code>riscv32</code> or <code>riscv64</code></a></h4>
<p>On this platform the usage of <code>#[target_feature]</code> functions follows the
<a href="codegen.html#r-attributes.codegen.target_feature.safety-restrictions">above restrictions</a>.</p>
<p>Further documentation on these features can be found in their respective
specification. Many specifications are described in the <a href="https://github.com/riscv/riscv-isa-manual">RISC-V ISA Manual</a> or
in another manual hosted on the <a href="https://github.com/riscv">RISC-V GitHub Account</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Implicitly Enables</th><th>Description</th></tr></thead><tbody>
<tr><td><code>a</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/de46343a245c6ee1f7b1a40c92fe1a86bd4f4978/src/a-st-ext.adoc">A</a> — Atomic instructions</td></tr>
<tr><td><code>c</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/de46343a245c6ee1f7b1a40c92fe1a86bd4f4978/src/c-st-ext.adoc">C</a> — Compressed instructions</td></tr>
<tr><td><code>m</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/de46343a245c6ee1f7b1a40c92fe1a86bd4f4978/src/m-st-ext.adoc">M</a> — Integer Multiplication and Division instructions</td></tr>
<tr><td><code>zb</code></td><td><code>zba</code>, <code>zbc</code>, <code>zbs</code></td><td><a href="https://github.com/riscv/riscv-bitmanip">Zb</a> — Bit Manipulation instructions</td></tr>
<tr><td><code>zba</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zba.adoc">Zba</a> — Address Generation instructions</td></tr>
<tr><td><code>zbb</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zbb.adoc">Zbb</a> — Basic bit-manipulation</td></tr>
<tr><td><code>zbc</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zbc.adoc">Zbc</a> — Carry-less multiplication</td></tr>
<tr><td><code>zbkb</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zbkb.adoc">Zbkb</a> — Bit Manipulation Instructions for Cryptography</td></tr>
<tr><td><code>zbkc</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zbc.adoc">Zbkc</a> — Carry-less multiplication for Cryptography</td></tr>
<tr><td><code>zbkx</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zbkx.adoc">Zbkx</a> — Crossbar permutations</td></tr>
<tr><td><code>zbs</code></td><td></td><td><a href="https://github.com/riscv/riscv-bitmanip/blob/main/bitmanip/zbs.adoc">Zbs</a> — Single-bit instructions</td></tr>
<tr><td><code>zk</code></td><td><code>zkn</code>, <code>zkr</code>, <code>zks</code>, <code>zkt</code>, <code>zbkb</code>, <code>zbkc</code>, <code>zkbx</code></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zk.adoc">Zk</a> — Scalar Cryptography</td></tr>
<tr><td><code>zkn</code></td><td><code>zknd</code>, <code>zkne</code>, <code>zknh</code>, <code>zbkb</code>, <code>zbkc</code>, <code>zkbx</code></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zkn.adoc">Zkn</a> — NIST Algorithm suite extension</td></tr>
<tr><td><code>zknd</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zknd.adoc">Zknd</a> — NIST Suite: AES Decryption</td></tr>
<tr><td><code>zkne</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zkne.adoc">Zkne</a> — NIST Suite: AES Encryption</td></tr>
<tr><td><code>zknh</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zknh.adoc">Zknh</a> — NIST Suite: Hash Function Instructions</td></tr>
<tr><td><code>zkr</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zkr.adoc">Zkr</a> — Entropy Source Extension</td></tr>
<tr><td><code>zks</code></td><td><code>zksed</code>, <code>zksh</code>, <code>zbkb</code>, <code>zbkc</code>, <code>zkbx</code></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zks.adoc">Zks</a> — ShangMi Algorithm Suite</td></tr>
<tr><td><code>zksed</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zksed.adoc">Zksed</a> — ShangMi Suite: SM4 Block Cipher Instructions</td></tr>
<tr><td><code>zksh</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zksh.adoc">Zksh</a> — ShangMi Suite: SM3 Hash Function Instructions</td></tr>
<tr><td><code>zkt</code></td><td></td><td><a href="https://github.com/riscv/riscv-crypto/blob/e2dd7d98b7f34d477e38cb5fd7a3af4379525189/doc/scalar/riscv-crypto-scalar-zkt.adoc">Zkt</a> — Data Independent Execution Latency Subset</td></tr>
</tbody></table>
</div><!-- Keep links near each table to make it easier to move and update. -->
<div class="rule" id="r-attributes.codegen.target_feature.wasm"><a class="rule-link" href="#r-attributes.codegen.target_feature.wasm" title="attributes.codegen.target_feature.wasm"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.wasm]<span/></a></div>
<h4 id="wasm32-or-wasm64"><a class="header" href="#wasm32-or-wasm64"><code>wasm32</code> or <code>wasm64</code></a></h4>
<p>Safe <code>#[target_feature]</code> functions may always be used in safe contexts on Wasm
platforms. It is impossible to cause undefined behavior via the
<code>#[target_feature]</code> attribute because attempting to use instructions
unsupported by the Wasm engine will fail at load time without the risk of being
interpreted in a way different from what the compiler expected.</p>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Implicitly Enables</th><th>Description</th></tr></thead><tbody>
<tr><td><code>bulk-memory</code></td><td></td><td><a href="https://github.com/WebAssembly/bulk-memory-operations">WebAssembly bulk memory operations proposal</a></td></tr>
<tr><td><code>extended-const</code></td><td></td><td><a href="https://github.com/WebAssembly/extended-const">WebAssembly extended const expressions proposal</a></td></tr>
<tr><td><code>mutable-globals</code></td><td></td><td><a href="https://github.com/WebAssembly/mutable-global">WebAssembly mutable global proposal</a></td></tr>
<tr><td><code>nontrapping-fptoint</code></td><td></td><td><a href="https://github.com/WebAssembly/nontrapping-float-to-int-conversions">WebAssembly non-trapping float-to-int conversion proposal</a></td></tr>
<tr><td><code>relaxed-simd</code></td><td><code>simd128</code></td><td><a href="https://github.com/WebAssembly/relaxed-simd">WebAssembly relaxed simd proposal</a></td></tr>
<tr><td><code>sign-ext</code></td><td></td><td><a href="https://github.com/WebAssembly/sign-extension-ops">WebAssembly sign extension operators Proposal</a></td></tr>
<tr><td><code>simd128</code></td><td></td><td><a href="https://github.com/webassembly/simd">WebAssembly simd proposal</a></td></tr>
<tr><td><code>multivalue</code></td><td></td><td><a href="https://github.com/webassembly/multi-value">WebAssembly multivalue proposal</a></td></tr>
<tr><td><code>reference-types</code></td><td></td><td><a href="https://github.com/webassembly/reference-types">WebAssembly reference-types proposal</a></td></tr>
<tr><td><code>tail-call</code></td><td></td><td><a href="https://github.com/webassembly/tail-call">WebAssembly tail-call proposal</a></td></tr>
</tbody></table>
</div><div class="rule" id="r-attributes.codegen.target_feature.info"><a class="rule-link" href="#r-attributes.codegen.target_feature.info" title="attributes.codegen.target_feature.info"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.info]<span/></a></div>
<h3 id="additional-information"><a class="header" href="#additional-information">Additional information</a></h3>
<div class="rule" id="r-attributes.codegen.target_feature.remark-cfg"><a class="rule-link" href="#r-attributes.codegen.target_feature.remark-cfg" title="attributes.codegen.target_feature.remark-cfg"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.remark-cfg]<span/></a></div>
<p>See the <a href="../conditional-compilation.html#target_feature"><code>target_feature</code> conditional compilation option</a> for selectively
enabling or disabling compilation of code based on compile-time settings. Note
that this option is not affected by the <code>target_feature</code> attribute, and is
only driven by the features enabled for the entire crate.</p>
<div class="rule" id="r-attributes.codegen.target_feature.remark-rt"><a class="rule-link" href="#r-attributes.codegen.target_feature.remark-rt" title="attributes.codegen.target_feature.remark-rt"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.remark-rt]<span/></a></div>
<p>See the <a href="../../std/arch/macro.is_x86_feature_detected.html"><code>is_x86_feature_detected</code></a> or <a href="../../std/arch/macro.is_aarch64_feature_detected.html"><code>is_aarch64_feature_detected</code></a> macros
in the standard library for runtime feature detection on these platforms.</p>
<blockquote>
<p>Note: <code>rustc</code> has a default set of features enabled for each target and CPU.
The CPU may be chosen with the <a href="../../rustc/codegen-options/index.html#target-cpu"><code>-C target-cpu</code></a> flag. Individual features
may be enabled or disabled for an entire crate with the
<a href="../../rustc/codegen-options/index.html#target-feature"><code>-C target-feature</code></a> flag.</p>
</blockquote>
<div class="rule" id="r-attributes.codegen.track_caller"><a class="rule-link" href="#r-attributes.codegen.track_caller" title="attributes.codegen.track_caller"><span>[attributes<wbr>.codegen<wbr>.track_caller]<span/></a></div>
<h2 id="the-track_caller-attribute"><a class="header" href="#the-track_caller-attribute">The <code>track_caller</code> attribute</a></h2>
<div class="rule" id="r-attributes.codegen.track_caller.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.track_caller.allowed-positions" title="attributes.codegen.track_caller.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.allowed-positions]<span/></a></div>
<p>The <code>track_caller</code> attribute may be applied to any function with <a href="../items/external-blocks.html#abi"><code>"Rust"</code> ABI</a>
with the exception of the entry point <code>fn main</code>.</p>
<div class="rule" id="r-attributes.codegen.track_caller.traits"><a class="rule-link" href="#r-attributes.codegen.track_caller.traits" title="attributes.codegen.track_caller.traits"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.traits]<span/></a></div>
<p>When applied to functions and methods in trait declarations, the attribute applies to all implementations. If the trait provides a
default implementation with the attribute, then the attribute also applies to override implementations.</p>
<div class="rule" id="r-attributes.codegen.track_caller.extern"><a class="rule-link" href="#r-attributes.codegen.track_caller.extern" title="attributes.codegen.track_caller.extern"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.extern]<span/></a></div>
<p>When applied to a function in an <code>extern</code> block the attribute must also be applied to any linked
implementations, otherwise undefined behavior results. When applied to a function which is made
available to an <code>extern</code> block, the declaration in the <code>extern</code> block must also have the attribute,
otherwise undefined behavior results.</p>
<div class="rule" id="r-attributes.codegen.track_caller.behavior"><a class="rule-link" href="#r-attributes.codegen.track_caller.behavior" title="attributes.codegen.track_caller.behavior"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.behavior]<span/></a></div>
<h3 id="behavior"><a class="header" href="#behavior">Behavior</a></h3>
<p>Applying the attribute to a function <code>f</code> allows code within <code>f</code> to get a hint of the <a href="../../core/panic/location/struct.Location.html"><code>Location</code></a> of
the “topmost” tracked call that led to <code>f</code>’s invocation. At the point of observation, an
implementation behaves as if it walks up the stack from <code>f</code>’s frame to find the nearest frame of an
<em>unattributed</em> function <code>outer</code>, and it returns the <a href="../../core/panic/location/struct.Location.html"><code>Location</code></a> of the tracked call in <code>outer</code>.</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[track_caller]
fn f() {
    println!("{}", std::panic::Location::caller());
}
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>Note: <code>core</code> provides <a href="../../core/panic/location/struct.Location.html#method.caller"><code>core::panic::Location::caller</code></a> for observing caller locations. It wraps
the <a href="../../core/intrinsics/fn.caller_location.html"><code>core::intrinsics::caller_location</code></a> intrinsic implemented by <code>rustc</code>.</p>
</blockquote>
<blockquote>
<p>Note: because the resulting <code>Location</code> is a hint, an implementation may halt its walk up the stack
early. See <a href="#limitations">Limitations</a> for important caveats.</p>
</blockquote>
<h4 id="examples"><a class="header" href="#examples">Examples</a></h4>
<p>When <code>f</code> is called directly by <code>calls_f</code>, code in <code>f</code> observes its callsite within <code>calls_f</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[track_caller]
</span><span class="boring">fn f() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">}
</span>fn calls_f() {
    f(); // &lt;-- f() prints this location
}
<span class="boring">}</span></code></pre></pre>
<p>When <code>f</code> is called by another attributed function <code>g</code> which is in turn called by <code>calls_g</code>, code in
both <code>f</code> and <code>g</code> observes <code>g</code>’s callsite within <code>calls_g</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[track_caller]
</span><span class="boring">fn f() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">}
</span>#[track_caller]
fn g() {
    println!("{}", std::panic::Location::caller());
    f();
}

fn calls_g() {
    g(); // &lt;-- g() prints this location twice, once itself and once from f()
}
<span class="boring">}</span></code></pre></pre>
<p>When <code>g</code> is called by another attributed function <code>h</code> which is in turn called by <code>calls_h</code>, all code
in <code>f</code>, <code>g</code>, and <code>h</code> observes <code>h</code>’s callsite within <code>calls_h</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[track_caller]
</span><span class="boring">fn f() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">}
</span><span class="boring">#[track_caller]
</span><span class="boring">fn g() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">    f();
</span><span class="boring">}
</span>#[track_caller]
fn h() {
    println!("{}", std::panic::Location::caller());
    g();
}

fn calls_h() {
    h(); // &lt;-- prints this location three times, once itself, once from g(), once from f()
}
<span class="boring">}</span></code></pre></pre>
<p>And so on.</p>
<div class="rule" id="r-attributes.codegen.track_caller.limits"><a class="rule-link" href="#r-attributes.codegen.track_caller.limits" title="attributes.codegen.track_caller.limits"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.limits]<span/></a></div>
<h3 id="limitations"><a class="header" href="#limitations">Limitations</a></h3>
<div class="rule" id="r-attributes.codegen.track_caller.hint"><a class="rule-link" href="#r-attributes.codegen.track_caller.hint" title="attributes.codegen.track_caller.hint"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.hint]<span/></a></div>
<p>This information is a hint and implementations are not required to preserve it.</p>
<div class="rule" id="r-attributes.codegen.track_caller.decay"><a class="rule-link" href="#r-attributes.codegen.track_caller.decay" title="attributes.codegen.track_caller.decay"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.decay]<span/></a></div>
<p>In particular, coercing a function with <code>#[track_caller]</code> to a function pointer creates a shim which
appears to observers to have been called at the attributed function’s definition site, losing actual
caller information across virtual calls. A common example of this coercion is the creation of a
trait object whose methods are attributed.</p>
<blockquote>
<p>Note: The aforementioned shim for function pointers is necessary because <code>rustc</code> implements
<code>track_caller</code> in a codegen context by appending an implicit parameter to the function ABI, but
this would be unsound for an indirect call because the parameter is not a part of the function’s
type and a given function pointer type may or may not refer to a function with the attribute. The
creation of a shim hides the implicit parameter from callers of the function pointer, preserving
soundness.</p>
</blockquote>
<div class="rule" id="r-attributes.codegen.instruction_set"><a class="rule-link" href="#r-attributes.codegen.instruction_set" title="attributes.codegen.instruction_set"><span>[attributes<wbr>.codegen<wbr>.instruction_set]<span/></a></div>
<h2 id="the-instruction_set-attribute"><a class="header" href="#the-instruction_set-attribute">The <code>instruction_set</code> attribute</a></h2>
<div class="rule" id="r-attributes.codegen.instruction_set.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.instruction_set.allowed-positions" title="attributes.codegen.instruction_set.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.allowed-positions]<span/></a></div>
<p>The <em><code>instruction_set</code> <a href="../attributes.html">attribute</a></em> may be applied to a function to control which instruction set the function will be generated for.</p>
<div class="rule" id="r-attributes.codegen.instruction_set.behavior"><a class="rule-link" href="#r-attributes.codegen.instruction_set.behavior" title="attributes.codegen.instruction_set.behavior"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.behavior]<span/></a></div>
<p>This allows mixing more than one instruction set in a single program on CPU architectures that support it.</p>
<div class="rule" id="r-attributes.codegen.instruction_set.syntax"><a class="rule-link" href="#r-attributes.codegen.instruction_set.syntax" title="attributes.codegen.instruction_set.syntax"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.syntax]<span/></a></div>
<p>It uses the <a href="../attributes.html#meta-item-attribute-syntax"><em>MetaListPath</em></a> syntax, and a path comprised of the architecture family name and instruction set name.</p>
<div class="rule" id="r-attributes.codegen.instruction_set.target-limits"><a class="rule-link" href="#r-attributes.codegen.instruction_set.target-limits" title="attributes.codegen.instruction_set.target-limits"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.target-limits]<span/></a></div>
<p>It is a compilation error to use the <code>instruction_set</code> attribute on a target that does not support it.</p>
<div class="rule" id="r-attributes.codegen.instruction_set.arm"><a class="rule-link" href="#r-attributes.codegen.instruction_set.arm" title="attributes.codegen.instruction_set.arm"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.arm]<span/></a></div>
<h3 id="on-arm"><a class="header" href="#on-arm">On ARM</a></h3>
<p>For the <code>ARMv4T</code> and <code>ARMv5te</code> architectures, the following are supported:</p>
<ul>
<li><code>arm::a32</code> — Generate the function as A32 “ARM” code.</li>
<li><code>arm::t32</code> — Generate the function as T32 “Thumb” code.</li>
</ul>
<!-- ignore: arm-only -->
<pre><code class="language-rust ignore">#[instruction_set(arm::a32)]
fn foo_arm_code() {}

#[instruction_set(arm::t32)]
fn bar_thumb_code() {}</code></pre>
<p>Using the <code>instruction_set</code> attribute has the following effects:</p>
<ul>
<li>If the address of the function is taken as a function pointer, the low bit of the address will be set to 0 (arm) or 1 (thumb) depending on the instruction set.</li>
<li>Any inline assembly in the function must use the specified instruction set instead of the target default.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../attributes/diagnostics.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../attributes/limits.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../attributes/diagnostics.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../attributes/limits.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/reference.js"></script>
        <script src="../theme/language-picker.js"></script>


    </div>
    </body>
</html>
