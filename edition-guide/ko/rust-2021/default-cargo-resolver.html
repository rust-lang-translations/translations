<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>기본 Cargo 기능 해결자 - The Rust Edition Guide</title>


        <!-- Custom HTML head -->

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-L455DH98TK"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-L455DH98TK');
        </script>
        
        
        <script>
            (function () {
                // See these pages for details:
                // https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls
                // https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics
        
                function gen_canonical_href(lang) {
        
                    let base = "https://rust-lang-translations.org/edition-guide";
        
                    let canonical_href;
                    if (lang == "en") {
                        canonical_href = `${base}/rust-2021/default-cargo-resolver.md`;
                    } else {
                        canonical_href = `${base}/${lang}/rust-2021/default-cargo-resolver.md`;
                    }
                    canonical_href = canonical_href.slice(0, -"md".length) + "html";
                    if (canonical_href.endsWith("/index.html")) {
                        canonical_href = canonical_href.slice(0, -"index.html".length);
                    }
                    return canonical_href;
                }
        
                const canonical_href = gen_canonical_href("ko");

                let link = document.createElement("link");
                link.rel = "canonical";
                link.href = canonical_href;
                document.head.appendChild(link);
        
        
                const langs = ["en"  , "ko" ];
        
                for (const lang of langs) {
                    const canonical_href = gen_canonical_href(lang);
        
                    let link = document.createElement("link");
                    link.rel = "alternate";
                    link.hreflang = lang;
                    link.href = canonical_href;
                    document.head.appendChild(link);
                }
            })()
        </script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Edition Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang-translations/project" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/edition-guide/edit/master/src/rust-2021/default-cargo-resolver.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="기본-cargo-기능-해결자"><a class="header" href="#기본-cargo-기능-해결자">기본 Cargo 기능 해결자</a></h1>
<h2 id="요약"><a class="header" href="#요약">요약</a></h2>
<ul>
<li><code>edition = "2021"</code>은 <code>Cargo.toml</code>에서 <code>resolver = "2"</code>를 의미합니다.</li>
</ul>
<h2 id="세부-정보"><a class="header" href="#세부-정보">세부 정보</a></h2>
<p>Rust 1.51.0부터 Cargo는 <code>Cargo.toml</code>에서 <code>resolver = "2"</code>로 활성화할 수 있는 <a href=".../../cargo/reference/resolver.html#feature-resolver-version-2">새로운 기능 해석기</a>에 대한 옵트인 지원을 제공합니다.</p>
<p>Rust 2021부터 이것이 기본값이 됩니다. 즉, <code>Cargo.toml</code>에 <code>edition = "2021"</code>을 작성하면 <code>resolver = "2"</code>를 의미합니다.</p>
<p>해석기는 <a href="../../cargo/reference/workspaces.html">작업 공간</a>에 대한 전역 설정이며 종속성에서는 설정이 무시됩니다. 이 설정은 작업 공간의 최상위 패키지에만 적용됩니다. <a href="../../cargo/reference/workspaces.html#virtual-workspace">가상 작업 공간</a>을 사용하는 경우 새 해석기를 옵트인하려면 <code>[workspace]</code> 정의에서 <a href="../../cargo/reference/resolver.html#resolver-versions"><code>resolver</code> 필드</a>를 명시적으로 설정해야 합니다.</p>
<p>새로운 기능 해석기는 더 이상 여러 방식으로 종속된 크레이트에 대해 요청된 모든 기능을 병합하지 않습니다. 자세한 내용은 <a href="https://blog.rust-lang.org/2021/03/25/Rust-1.51.0.html#cargos-new-feature-resolver">Rust 1.51 발표</a>를 참조하십시오.</p>
<h2 id="마이그레이션"><a class="header" href="#마이그레이션">마이그레이션</a></h2>
<p>새 해석기로 업데이트하기 위한 자동화된 마이그레이션 도구는 없습니다. 대부분의 프로젝트에서는 업데이트로 인해 변경 사항이 거의 또는 전혀 없습니다.</p>
<p><code>cargo fix --edition</code>으로 업데이트할 때 새 해석기가 다른 기능으로 종속성을 빌드하는 경우 Cargo는 보고서를 표시합니다. 다음과 같이 보일 수 있습니다.</p>
<blockquote>
<p>참고: 2021 에디션으로 전환하면 Cargo에서 버전 2 기능 해석기를 사용할 수 있습니다. 이로 인해 일부 종속성이 이전보다 더 적은 기능으로 빌드될 수 있습니다. 해석기 변경에 대한 자세한 내용은 <a href="https://doc.rust-lang.org/nightly/edition-guide/rust-2021/default-cargo-resolver.html">https://doc.rust-lang.org/nightly/edition-guide/rust-2021/default-cargo-resolver.html</a>에서 확인할 수 있습니다.<br> 다음 종속성을 빌드할 때 주어진 기능은 더 이상 사용되지 않습니다.</p>
<pre><code class="language-text">  bstr v0.2.16: default, lazy_static, regex-automata, unicode
  libz-sys v1.1.3 (as host dependency): libc
</code></pre>
</blockquote>
<p>이를 통해 특정 종속성이 더 이상 주어진 기능으로 빌드되지 않음을 알 수 있습니다.</p>
<h3 id="빌드-실패"><a class="header" href="#빌드-실패">빌드 실패</a></h3>
<p>변경 후 프로젝트가 올바르게 빌드되지 않는 경우가 있을 수 있습니다. 한 패키지의 종속성 선언이 다른 패키지에서 특정 기능이 활성화되어 있다고 가정하고 해당 기능이 이제 비활성화된 경우 컴파일에 실패할 수 있습니다.</p>
<p>예를 들어, 다음과 같은 종속성이 있다고 가정해 보겠습니다.</p>
<pre><code class="language-toml"># Cargo.toml

[dependencies]
bstr = { version = "0.2.16", default-features = false }
# ...
</code></pre>
<p>그리고 종속성 트리의 어딘가에 다른 패키지에 다음이 있습니다.</p>
<pre><code class="language-toml"># Another package's Cargo.toml

[build-dependencies]
bstr = "0.2.16"
</code></pre>
<p>In our package, we've been using the <a href="https://docs.rs/bstr/0.2.16/bstr/trait.ByteSlice.html#method.words_with_breaks"><code>words_with_breaks</code></a> method from <code>bstr</code>, which requires <code>bstr</code>'s  "unicode" feature to be enabled. This has historically worked because Cargo unified the features of <code>bstr</code> between the two packages. However, after updating to Rust 2021, the new resolver will build <code>bstr</code> twice, once with the default features (as a build dependency), and once with no features (as our normal dependency). Since <code>bstr</code> is now being built without the "unicode" feature, the <code>words_with_breaks</code> method doesn't exist, and the build will fail with an error that the method is missing.</p>
<p>The solution here is to ensure that the dependency is declared with the features you are actually using. For example:</p>
<pre><code class="language-toml">[dependencies]
bstr = { version = "0.2.16", default-features = false, features = ["unicode"] }
</code></pre>
<p>In some cases, this may be a problem with a third-party dependency that you don't have direct control over. You can consider submitting a patch to that project to try to declare the correct set of features for the problematic dependency. Alternatively, you can add features to any dependency from within your own <code>Cargo.toml</code> file. For example, if the <code>bstr</code> example given above was declared in some third-party dependency, you can just copy the correct dependency declaration into your own project. The features will be unified, as long as they match the unification rules of the new resolver. Those are:</p>
<ul>
<li>Features enabled on platform-specific dependencies for targets not currently being built are ignored.</li>
<li>Build-dependencies and proc-macros do not share features with normal dependencies.</li>
<li>Dev-dependencies do not activate features unless building a target that needs them (like tests or examples).</li>
</ul>
<p>A real-world example is using <a href="https://crates.io/crates/diesel"><code>diesel</code></a> and <a href="https://crates.io/crates/diesel_migrations"><code>diesel_migrations</code></a>. These packages provide database support, and the database is selected using a feature, like this:</p>
<pre><code class="language-toml">[dependencies]
diesel = { version = "1.4.7", features = ["postgres"] }
diesel_migrations = "1.4.0"
</code></pre>
<p>The problem is that <code>diesel_migrations</code> has an internal proc-macro which itself depends on <code>diesel</code>, and the proc-macro assumes its own copy of <code>diesel</code> has the same features enabled as the rest of the dependency graph. After updating to the new resolver, it fails to build because now there are two copies of <code>diesel</code>, and the one built for the proc-macro is missing the "postgres" feature.</p>
<p>A solution here is to add <code>diesel</code> as a build-dependency with the required features, for example:</p>
<pre><code class="language-toml">[build-dependencies]
diesel = { version = "1.4.7", features = ["postgres"] }
</code></pre>
<p>This causes Cargo to add "postgres" as a feature for host dependencies (proc-macros and build-dependencies). Now, the <code>diesel_migrations</code> proc-macro will get the "postgres" feature enabled, and it will build correctly.</p>
<p>The 2.0 release of <code>diesel</code> (currently in development) does not have this problem as it has been restructured to not have this dependency requirement.</p>
<h3 id="exploring-features"><a class="header" href="#exploring-features">Exploring features</a></h3>
<p>The <a href="../../cargo/commands/cargo-tree.html"><code>cargo tree</code></a> command has had substantial improvements to help with the migration to the new resolver. <code>cargo tree</code> can be used to explore the dependency graph, and to see which features are being enabled, and importantly <em>why</em> they are being enabled.</p>
<p>One option is to use the <code>--duplicates</code> flag (<code>-d</code> for short), which will tell you when a package is being built multiple times. Taking the <code>bstr</code> example from earlier, we might see:</p>
<pre><code class="language-console">&gt; cargo tree -d
bstr v0.2.16
└── foo v0.1.0 (/MyProjects/foo)

bstr v0.2.16
[build-dependencies]
└── bar v0.1.0
    └── foo v0.1.0 (/MyProjects/foo)

</code></pre>
<p>This output tells us that <code>bstr</code> is built twice, and shows the chain of dependencies that led to its inclusion in both cases.</p>
<p>You can print which features each package is using with the <code>-f</code> flag, like this:</p>
<pre><code class="language-console">cargo tree -f '{p} {f}'
</code></pre>
<p>This tells Cargo to change the "format" of the output, where it will print both the package and the enabled features.</p>
<p>You can also use the <code>-e</code> flag to tell it which "edges" to display. For example, <code>cargo tree -e features</code> will show in-between each dependency which features are being added by each dependency. This option becomes more useful with the <code>-i</code> flag which can be used to "invert" the tree. This allows you to see how features <em>flow</em> into a given dependency. For example, let's say the dependency graph is large, and we're not quite sure who is depending on <code>bstr</code>, the following command will show that:</p>
<pre><code class="language-console">&gt; cargo tree -e features -i bstr
bstr v0.2.16
├── bstr feature "default"
│   [build-dependencies]
│   └── bar v0.1.0
│       └── bar feature "default"
│           └── foo v0.1.0 (/MyProjects/foo)
├── bstr feature "lazy_static"
│   └── bstr feature "unicode"
│       └── bstr feature "default" (*)
├── bstr feature "regex-automata"
│   └── bstr feature "unicode" (*)
├── bstr feature "std"
│   └── bstr feature "default" (*)
└── bstr feature "unicode" (*)
</code></pre>
<p>This snippet of output shows that the project <code>foo</code> depends on <code>bar</code> with the "default" feature. Then, <code>bar</code> depends on <code>bstr</code> as a build-dependency with the "default" feature. We can further see that <code>bstr</code>'s  "default" feature enables "unicode" (among other features).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../rust-2021/prelude.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../rust-2021/IntoIterator-for-arrays.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../rust-2021/prelude.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../rust-2021/IntoIterator-for-arrays.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/language-picker.js"></script>


    </div>
    </body>
</html>
